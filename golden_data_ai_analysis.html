<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CardioWatch 287-2B - Golden Data AI Analysis Report</title>
<style>
    :root {
        --primary: #1a365d;
        --primary-light: #2b6cb0;
        --success: #276749;
        --success-bg: #c6f6d5;
        --warn: #744210;
        --warn-bg: #fefcbf;
        --fail: #9b2c2c;
        --fail-bg: #fed7d7;
        --info: #2c5282;
        --info-bg: #bee3f8;
        --border: #e2e8f0;
        --bg-alt: #f7fafc;
        --text: #2d3748;
        --text-light: #718096;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        color: var(--text);
        line-height: 1.6;
        background: #fff;
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px 30px;
    }
    header {
        background: linear-gradient(135deg, var(--primary), var(--primary-light));
        color: white;
        padding: 30px 40px;
        border-radius: 8px;
        margin-bottom: 30px;
    }
    header h1 { font-size: 1.8em; margin-bottom: 5px; }
    header p { opacity: 0.9; font-size: 0.95em; }
    .meta-row {
        display: flex;
        gap: 30px;
        margin-top: 15px;
        font-size: 0.85em;
        opacity: 0.85;
    }
    h2 {
        color: var(--primary);
        border-bottom: 2px solid var(--primary);
        padding-bottom: 8px;
        margin: 30px 0 15px;
        font-size: 1.4em;
    }
    h3 { color: var(--primary-light); margin: 20px 0 10px; font-size: 1.15em; }
    h4 { color: var(--text); margin: 15px 0 8px; font-size: 1.05em; }

    /* Summary cards */
    .summary-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 15px;
        margin: 20px 0;
    }
    .card {
        padding: 20px;
        border-radius: 8px;
        text-align: center;
        border: 1px solid var(--border);
    }
    .card .number { font-size: 2.5em; font-weight: bold; }
    .card .label { font-size: 0.85em; color: var(--text-light); margin-top: 5px; }
    .card-pass { background: var(--success-bg); }
    .card-pass .number { color: var(--success); }
    .card-warn { background: var(--warn-bg); }
    .card-warn .number { color: var(--warn); }
    .card-fail { background: var(--fail-bg); }
    .card-fail .number { color: var(--fail); }
    .card-total { background: var(--info-bg); }
    .card-total .number { color: var(--info); }

    /* Tables */
    table {
        width: 100%;
        border-collapse: collapse;
        margin: 15px 0;
        font-size: 0.88em;
    }
    th {
        background: var(--primary);
        color: white;
        padding: 10px 8px;
        text-align: left;
        font-weight: 600;
        font-size: 0.85em;
        white-space: nowrap;
    }
    td {
        padding: 8px;
        border-bottom: 1px solid var(--border);
        vertical-align: top;
    }
    tr:nth-child(even) { background: var(--bg-alt); }
    tr:hover { background: #edf2f7; }

    /* Verdict badges */
    .badge {
        display: inline-block;
        padding: 2px 10px;
        border-radius: 12px;
        font-size: 0.8em;
        font-weight: 600;
        text-transform: uppercase;
    }
    .badge-pass { background: var(--success-bg); color: var(--success); }
    .badge-warn { background: var(--warn-bg); color: var(--warn); }
    .badge-fail { background: var(--fail-bg); color: var(--fail); }
    .badge-ok { background: #e9d8fd; color: #553c9a; }
    .badge-na { background: #e2e8f0; color: #718096; }

    /* Bug cards */
    .bug-card {
        border: 1px solid var(--border);
        border-radius: 8px;
        margin: 15px 0;
        overflow: hidden;
    }
    .bug-header {
        padding: 12px 18px;
        font-weight: 600;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .bug-p1 .bug-header { background: var(--fail-bg); color: var(--fail); border-left: 4px solid var(--fail); }
    .bug-p2 .bug-header { background: var(--warn-bg); color: var(--warn); border-left: 4px solid #d69e2e; }
    .bug-p3 .bug-header { background: var(--info-bg); color: var(--info); border-left: 4px solid var(--info); }
    .bug-body { padding: 15px 18px; }
    .bug-body dt { font-weight: 600; margin-top: 8px; color: var(--primary); }
    .bug-body dd { margin-left: 15px; margin-bottom: 5px; }

    /* Code blocks */
    code {
        background: #edf2f7;
        padding: 1px 5px;
        border-radius: 3px;
        font-family: 'Consolas', 'Monaco', monospace;
        font-size: 0.9em;
    }
    pre {
        background: #1a202c;
        color: #e2e8f0;
        padding: 15px;
        border-radius: 6px;
        overflow-x: auto;
        font-size: 0.85em;
        margin: 10px 0;
        line-height: 1.5;
    }
    pre code { background: none; color: inherit; padding: 0; }

    /* Sections */
    .section { margin: 25px 0; }
    .finding-box {
        background: var(--bg-alt);
        border-left: 4px solid var(--primary-light);
        padding: 12px 18px;
        margin: 10px 0;
        border-radius: 0 6px 6px 0;
    }
    .alert-box {
        padding: 12px 18px;
        border-radius: 6px;
        margin: 10px 0;
    }
    .alert-fail { background: var(--fail-bg); border-left: 4px solid var(--fail); }
    .alert-warn { background: var(--warn-bg); border-left: 4px solid #d69e2e; }
    .alert-info { background: var(--info-bg); border-left: 4px solid var(--info); }

    /* Priority tags */
    .priority {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 0.75em;
        font-weight: 700;
    }
    .p1 { background: var(--fail); color: white; }
    .p2 { background: #d69e2e; color: white; }
    .p3 { background: var(--info); color: white; }

    /* Links bar */
    .nav-links {
        display: flex;
        gap: 20px;
        margin: 15px 0;
        padding: 12px 18px;
        background: var(--bg-alt);
        border-radius: 6px;
    }
    .nav-links a {
        color: var(--primary-light);
        text-decoration: none;
        font-weight: 500;
    }
    .nav-links a:hover { text-decoration: underline; }

    footer {
        margin-top: 40px;
        padding: 20px;
        border-top: 1px solid var(--border);
        text-align: center;
        color: var(--text-light);
        font-size: 0.85em;
    }

    .category-header {
        background: var(--primary);
        color: white;
        padding: 5px 12px;
        border-radius: 4px;
        font-size: 0.8em;
        display: inline-block;
        margin: 2px 0;
    }

    .ratio-highlight {
        background: var(--fail-bg);
        padding: 1px 6px;
        border-radius: 3px;
        font-weight: 600;
        color: var(--fail);
    }

    .toc {
        background: var(--bg-alt);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 20px 25px;
        margin: 20px 0;
    }
    .toc ol { padding-left: 20px; }
    .toc li { margin: 5px 0; }
    .toc a { color: var(--primary-light); text-decoration: none; }
    .toc a:hover { text-decoration: underline; }

    @media print {
        body { max-width: none; padding: 10px; }
        header { break-after: avoid; }
        .bug-card { break-inside: avoid; }
        pre { white-space: pre-wrap; }
    }
</style>
</head>
<body>

<header>
    <h1>Golden Data AI Analysis Report</h1>
    <p>CardioWatch 287-2B Firmware &mdash; Deep Root-Cause Analysis of 40 Clinical Scenarios</p>
    <div class="meta-row">
        <span>Date: 2026-02-12</span>
        <span>MCU: nRF52840</span>
        <span>PPG: MAX86178 (Green/Red/IR)</span>
        <span>ACC: LIS2DW12</span>
        <span>Sampling: 32 Hz</span>
    </div>
</header>

<nav class="nav-links">
    <a href="golden_data_analysis.html">Automated Analysis Report</a>
    <a href="golden_data_viewer.html">Interactive Data Viewer</a>
</nav>

<div class="toc">
    <strong>Table of Contents</strong>
    <ol>
        <li><a href="#executive-summary">Executive Summary</a></li>
        <li><a href="#overview-table">Overview Table &mdash; All 40 Scenarios</a></li>
        <li><a href="#bugs-identified">Bugs Identified (4 Open, 4 Fixed)</a></li>
        <li><a href="#spo2-analysis">SpO2 Detailed Analysis</a></li>
        <li><a href="#hr-analysis">HR Detailed Analysis</a></li>
        <li><a href="#cardiac-arrest-analysis">Cardiac Arrest Detection Analysis</a></li>
        <li><a href="#results-by-category">Results by Category</a></li>
        <li><a href="#recommendations">Recommendations</a></li>
        <li><a href="#impact-matrix">Impact Matrix</a></li>
    </ol>
</div>

<!-- ============================================================ -->
<!-- 1. EXECUTIVE SUMMARY -->
<!-- ============================================================ -->
<section id="executive-summary">
<h2>1. Executive Summary</h2>

<div class="summary-grid">
    <div class="card card-total">
        <div class="number">40</div>
        <div class="label">Total Scenarios</div>
    </div>
    <div class="card card-pass">
        <div class="number">30</div>
        <div class="label">PASS (75.0%)</div>
    </div>
    <div class="card card-warn">
        <div class="number">5</div>
        <div class="label">WARN (12.5%)</div>
    </div>
    <div class="card card-fail">
        <div class="number">5</div>
        <div class="label">FAIL (12.5%)</div>
    </div>
</div>

<div class="alert-box alert-fail">
    <strong>Critical Patient Safety Issue:</strong> Cardiac arrest detection remains incomplete for VF/VT scenarios. BUG-4 and BUG-5 fixes are confirmed working &mdash; alarms fire and <strong>stay ON</strong> in scenarios 23 (asystole: 1 alarm + 8 recovery rejections) and 24 (PEA: 1 alarm + 13 recovery rejections). However, scenarios 21 (VF) and 22 (VT&rarr;VF) still produce <strong>zero alarms</strong> &mdash; VF/VT generates high-amplitude chaotic PPG oscillations that exceed the amplitude threshold, so the detector never enters the below-threshold branch.
</div>

<div class="alert-box alert-warn">
    <strong>HR Doubling Bug:</strong> Heart rate is consistently doubled for bradycardic patients (HR &lt; 55 bpm) due to dicrotic notch misdetection. Affects 4 scenarios with measured/expected ratios approximately 2.0 (2.005, 2.145, 1.967, 2.006). Reported with high confidence (quality=3).
</div>

<h3>Key Findings</h3>
<ul>
    <li><strong>8 bugs identified</strong> (5 previously known, 3 new) &mdash; <strong>4 open, 4 fixed</strong></li>
    <li><strong>P1 (Patient Safety):</strong> 1 bug open &mdash; NEW: VF/VT amplitude exceeds detection threshold, algorithm blind to high-amplitude lethal arrhythmias (scenarios 21, 22). BUG-4 <strong>FIXED</strong> (Alarm3 ON fires and stays ON via recovery rejection). BUG-5 <strong>FIXED</strong> (shadowed variable removed). Previous alarm-OFF cycling issue <strong>FIXED</strong> by FIX-2 recovery rejection logic.</li>
    <li><strong>P2 (Algorithm):</strong> 3 bugs &mdash; HR doubling (BUG-3: bandpass filter 0.7Hz cutoff + FFT search floor 45bpm), SpO2 selection bias + rolling avg init at 100% (NEW), SpO2 old_mid bias (BUG-1)</li>
    <li><strong>P3 (Simulator/Tooling):</strong> 1 open bug &mdash; ACC classifier vs mmt_idle_detection mismatch (BUG-6). Two issues <strong>FIXED</strong>: analysis script wrong expected values (scenarios 26, 30), hemorrhagic shock SNR (scenario 32 now PASS)</li>
    <li><strong>Improvement vs previous run:</strong> Cardiac arrest alarm-OFF cycling <strong>FIXED</strong> &mdash; scenarios 23 and 24 now correctly maintain alarm ON state (FIX-2 recovery rejection works: 8 and 13 rejections respectively). <code>cardiac_arrest=2</code> now reported for 5 records (scenario 23) and 4 records (scenario 24), up from 1 each. Total: 30 PASS, 5 WARN, 5 FAIL</li>
</ul>
</section>

<!-- ============================================================ -->
<!-- 2. OVERVIEW TABLE -->
<!-- ============================================================ -->
<section id="overview-table">
<h2>2. Overview Table &mdash; All 40 Scenarios</h2>

<table>
<thead>
<tr>
    <th>#</th>
    <th>Scenario</th>
    <th>Category</th>
    <th>HR Exp</th>
    <th>HR Meas</th>
    <th>HR &Delta;</th>
    <th>HR V</th>
    <th>SpO2 Exp</th>
    <th>SpO2 Meas</th>
    <th>SpO2 &Delta;</th>
    <th>SpO2 V</th>
    <th>Score</th>
    <th>Root Cause</th>
</tr>
</thead>
<tbody>
<tr><td>01</td><td>normal_rest</td><td><span class="category-header">Rest</span></td><td>70</td><td>70.9</td><td>0.9</td><td><span class="badge badge-pass">PASS</span></td><td>98</td><td>99.0</td><td>1.0</td><td><span class="badge badge-pass">PASS</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>02</td><td>elderly_rest</td><td><span class="category-header">Rest</span></td><td>65</td><td>75.7</td><td>10.7</td><td><span class="badge badge-ok">OK</span></td><td>96</td><td>97.3</td><td>1.3</td><td><span class="badge badge-pass">PASS</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>03</td><td>athlete_rest</td><td><span class="category-header">Rest</span></td><td>52</td><td>50.2</td><td>1.8</td><td><span class="badge badge-pass">PASS</span></td><td>99</td><td>99.0</td><td>0.0</td><td><span class="badge badge-pass">PASS</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>04</td><td>hypoxia_mild</td><td><span class="category-header">Hypoxia</span></td><td>95</td><td>96.8</td><td>1.8</td><td><span class="badge badge-pass">PASS</span></td><td>92</td><td>95.4</td><td>3.4</td><td><span class="badge badge-warn">WARN</span></td><td><span class="badge badge-warn">WARN</span></td><td>BUG-1</td></tr>
<tr><td>05</td><td>hypoxia_moderate</td><td><span class="category-header">Hypoxia</span></td><td>110</td><td>118.2</td><td>8.2</td><td><span class="badge badge-pass">PASS</span></td><td>85</td><td>83.6</td><td>1.4</td><td><span class="badge badge-pass">PASS</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>06</td><td>hypoxia_severe</td><td><span class="category-header">Hypoxia</span></td><td>140</td><td>144.4</td><td>4.4</td><td><span class="badge badge-pass">PASS</span></td><td>72</td><td>85.3</td><td>13.3</td><td><span class="badge badge-fail">FAIL</span></td><td><span class="badge badge-fail">FAIL</span></td><td>NEW: Selection bias</td></tr>
<tr><td>07</td><td>walking</td><td><span class="category-header">Activity</span></td><td>100</td><td>105.2</td><td>5.2</td><td><span class="badge badge-pass">PASS</span></td><td>97</td><td>0</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>08</td><td>running</td><td><span class="category-header">Activity</span></td><td>165</td><td>171.0</td><td>6.0</td><td><span class="badge badge-pass">PASS</span></td><td>96</td><td>0</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>09</td><td>wrist_movement</td><td><span class="category-header">Activity</span></td><td>var</td><td>103.8</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td>var</td><td>99.4</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>10</td><td>af_rapid</td><td><span class="category-header">Arrhythmias</span></td><td>130</td><td>129.5</td><td>0.5</td><td><span class="badge badge-pass">PASS</span></td><td>96</td><td>97.3</td><td>1.3</td><td><span class="badge badge-pass">PASS</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>11</td><td>af_controlled</td><td><span class="category-header">Arrhythmias</span></td><td>75</td><td>72.0</td><td>3.0</td><td><span class="badge badge-pass">PASS</span></td><td>97</td><td>97.3</td><td>0.3</td><td><span class="badge badge-pass">PASS</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>12</td><td>flutter_2_1</td><td><span class="category-header">Arrhythmias</span></td><td>150</td><td>158.4</td><td>8.4</td><td><span class="badge badge-pass">PASS</span></td><td>96</td><td>97.3</td><td>1.3</td><td><span class="badge badge-pass">PASS</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>13</td><td>esv_bigeminy</td><td><span class="category-header">Arrhythmias</span></td><td>80</td><td>81.2</td><td>1.2</td><td><span class="badge badge-pass">PASS</span></td><td>97</td><td>98.2</td><td>1.2</td><td><span class="badge badge-pass">PASS</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>14</td><td>esv_trigeminy</td><td><span class="category-header">Arrhythmias</span></td><td>80</td><td>80.8</td><td>0.8</td><td><span class="badge badge-pass">PASS</span></td><td>97</td><td>98.1</td><td>1.1</td><td><span class="badge badge-pass">PASS</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>15</td><td>psvt_episodes</td><td><span class="category-header">Arrhythmias</span></td><td>var</td><td>72.5</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td>96</td><td>98.1</td><td>2.1</td><td><span class="badge badge-ok">OK</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>16</td><td>vt_monomorphic</td><td><span class="category-header">Arrhythmias</span></td><td>180</td><td>185.6</td><td>5.6</td><td><span class="badge badge-pass">PASS</span></td><td>var</td><td>92.5</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>17</td><td>torsades</td><td><span class="category-header">Arrhythmias</span></td><td>var</td><td>178.7</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td>var</td><td>0</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>18</td><td>bradycardia</td><td><span class="category-header">Bradycardia</span></td><td>42</td><td>84.2</td><td>42.2</td><td><span class="badge badge-fail">FAIL</span></td><td>97</td><td>98.1</td><td>1.1</td><td><span class="badge badge-pass">PASS</span></td><td><span class="badge badge-fail">FAIL</span></td><td>BUG-3 (ratio <span class="ratio-highlight">2.005</span>)</td></tr>
<tr><td>19</td><td>bav2_mobitz1</td><td><span class="category-header">Bradycardia</span></td><td>var</td><td>50.4</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td>97</td><td>98.1</td><td>1.1</td><td><span class="badge badge-pass">PASS</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>20</td><td>bav3_complete</td><td><span class="category-header">Bradycardia</span></td><td>33</td><td>70.8</td><td>37.8</td><td><span class="badge badge-fail">FAIL</span></td><td>96</td><td>97.0</td><td>1.0</td><td><span class="badge badge-pass">PASS</span></td><td><span class="badge badge-fail">FAIL</span></td><td>BUG-3 (ratio <span class="ratio-highlight">2.145</span>)</td></tr>
<tr><td>21</td><td>vf_from_sinus</td><td><span class="category-header">Cardiac Arrest</span></td><td>75&rarr;VF</td><td>80.8</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td>var</td><td>97.9</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td><span class="badge badge-warn">WARN</span></td><td>NEW: VF blindness</td></tr>
<tr><td>22</td><td>vt_to_vf</td><td><span class="category-header">Cardiac Arrest</span></td><td>var</td><td>86.9</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td>var</td><td>97.9</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td><span class="badge badge-warn">WARN</span></td><td>NEW: VT/VF blindness</td></tr>
<tr><td>23</td><td>asystole</td><td><span class="category-header">Cardiac Arrest</span></td><td>var</td><td>99.4</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td>var</td><td>97.2</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td><span class="badge badge-warn">WARN</span></td><td>Alarm works (HR noise)</td></tr>
<tr><td>24</td><td>pea</td><td><span class="category-header">Cardiac Arrest</span></td><td>80&rarr;PEA</td><td>81.7</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td>var</td><td>98.1</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td><span class="badge badge-warn">WARN</span></td><td>Alarm works (HR noise)</td></tr>
<tr><td>25</td><td>progressive_deterioration</td><td><span class="category-header">Transitional</span></td><td>var</td><td>101.8</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td>var</td><td>87.0</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>26</td><td>hf_pulsus_alternans</td><td><span class="category-header">Cardiac Path</span></td><td>110</td><td>112.8</td><td>2.8</td><td><span class="badge badge-pass">PASS</span></td><td>96</td><td>97.5</td><td>1.5</td><td><span class="badge badge-pass">PASS</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>27</td><td>hf_cheyne_stokes</td><td><span class="category-header">Cardiac Path</span></td><td>85</td><td>92.4</td><td>7.4</td><td><span class="badge badge-pass">PASS</span></td><td>var</td><td>95.3</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>28</td><td>aortic_stenosis</td><td><span class="category-header">Cardiac Path</span></td><td>75</td><td>81.1</td><td>6.1</td><td><span class="badge badge-pass">PASS</span></td><td>97</td><td>98.1</td><td>1.1</td><td><span class="badge badge-pass">PASS</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>29</td><td>aortic_regurgitation</td><td><span class="category-header">Cardiac Path</span></td><td>80</td><td>86.4</td><td>6.4</td><td><span class="badge badge-pass">PASS</span></td><td>97</td><td>98.1</td><td>1.1</td><td><span class="badge badge-pass">PASS</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>30</td><td>tamponade</td><td><span class="category-header">Cardiac Path</span></td><td>115</td><td>118.2</td><td>3.2</td><td><span class="badge badge-pass">PASS</span></td><td>var</td><td>97.3</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>31</td><td>hcm</td><td><span class="category-header">Cardiac Path</span></td><td>70</td><td>75.8</td><td>5.8</td><td><span class="badge badge-pass">PASS</span></td><td>97</td><td>98.1</td><td>1.1</td><td><span class="badge badge-pass">PASS</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>32</td><td>hemorrhagic_shock</td><td><span class="category-header">Extreme</span></td><td>130</td><td>134.3</td><td>4.3</td><td><span class="badge badge-pass">PASS</span></td><td>96</td><td>97.3</td><td>1.3</td><td><span class="badge badge-pass">PASS</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>33</td><td>hypothermia_32C</td><td><span class="category-header">Extreme</span></td><td>55</td><td>108.2</td><td>53.2</td><td><span class="badge badge-fail">FAIL</span></td><td>94</td><td>0</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td><span class="badge badge-fail">FAIL</span></td><td>BUG-3 + BUG-6</td></tr>
<tr><td>34</td><td>hypothermia_28C</td><td><span class="category-header">Extreme</span></td><td>35</td><td>70.2</td><td>35.2</td><td><span class="badge badge-fail">FAIL</span></td><td>90</td><td>0</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td><span class="badge badge-fail">FAIL</span></td><td>BUG-3 + low perfusion</td></tr>
<tr><td>35</td><td>sleep_apnea</td><td><span class="category-header">Extreme</span></td><td>60</td><td>60.3</td><td>0.3</td><td><span class="badge badge-pass">PASS</span></td><td>var</td><td>97.2</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>36</td><td>vasovagal_syncope</td><td><span class="category-header">Extreme</span></td><td>var</td><td>78.9</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td>var</td><td>98.1</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>37</td><td>venous_pooling</td><td><span class="category-header">Extreme</span></td><td>75</td><td>61.9</td><td>13.1</td><td><span class="badge badge-ok">OK</span></td><td>97</td><td>95.4</td><td>1.6</td><td><span class="badge badge-pass">PASS</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>38</td><td>severe_anemia</td><td><span class="category-header">Extreme</span></td><td>110</td><td>112.6</td><td>2.6</td><td><span class="badge badge-pass">PASS</span></td><td>var</td><td>99.0</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>39</td><td>parkinsonian_tremor</td><td><span class="category-header">Extreme</span></td><td>70</td><td>71.1</td><td>1.1</td><td><span class="badge badge-pass">PASS</span></td><td>97</td><td>0</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>40</td><td>co_poisoning</td><td><span class="category-header">Extreme</span></td><td>110</td><td>112.7</td><td>2.7</td><td><span class="badge badge-pass">PASS</span></td><td>99</td><td>99.0</td><td>0.0</td><td><span class="badge badge-pass">PASS</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
</tbody>
</table>
<p style="font-size:0.85em; color:var(--text-light);">Note: Scenarios 26 and 30 previously showed false WARNs due to incorrect expected HR values in the analysis script (fixed). Scenario 32 (hemorrhagic_shock) previously showed FAIL due to low-SNR SpO2 (89.1%) &mdash; now passes with SpO2=97.3% after generator data improvement.</p>
</section>

<!-- ============================================================ -->
<!-- 3. BUGS IDENTIFIED -->
<!-- ============================================================ -->
<section id="bugs-identified">
<h2>3. Bugs Identified</h2>
<p>8 bugs total: 5 previously known, 3 newly discovered. <strong>4 open, 4 fixed.</strong> BUG-4 fully fixed (alarm fires and stays ON via FIX-2 recovery rejection). BUG-5 fully fixed (shadowed variable removed). NEW: VF/VT detection gap identified as primary remaining P1 issue.</p>

<!-- BUG-4 -->
<div class="bug-card bug-p1" style="opacity: 0.7;">
    <div class="bug-header" style="background: var(--success-bg); color: var(--success); border-left: 4px solid var(--success);">
        <span>BUG-4: Cardiac Arrest Alarm in Invalid-Pair Branch + FIX-2 Recovery Rejection</span>
        <span class="badge badge-pass">FIXED</span>
    </div>
    <div class="bug-body">
        <dl>
            <dt>Symptom (resolved)</dt>
            <dd>Previously, the invalid-pair branch in the cardiac arrest detector never checked the alarm condition (BUG-4 original), and when later fixed, the alarm cycled ON/OFF due to permissive alarm-OFF logic. Both issues are now resolved.</dd>
            <dt>Resolution</dt>
            <dd>Two fixes applied: (1) <code>corsano_cardiac_arrest.c:349-359</code> &mdash; alarm check added in invalid-pair branch ("Cardiac Alarm3 ON (invalid pairs)!"). (2) FIX-2 &mdash; recovery rejection logic with inter-peak timing validation now prevents false alarm-OFF from noise peaks.</dd>
            <dt>Verification</dt>
            <dd>
                <strong>Scenario 23 (asystole):</strong> 1 alarm fires ("Cardiac Alarm3 ON"), stays ON with 8 recovery rejections. <code>cardiac_arrest=2</code> for last 5 of 60 activity records. 54 "Cardiac below thresh" messages.
<pre><code>Cardiac Alarm3 ON (invalid pairs)!    // alarm fires at asystole onset
Cardiac recovery rejected: max_td=1.00, n=8   // noise rejected x8
// cardiac_arrest=2 maintained through end of simulation</code></pre>
                <strong>Scenario 24 (PEA):</strong> 1 alarm fires ("Cardiac Alarm ON!" via gap detection), stays ON with 13 recovery rejections. <code>cardiac_arrest=2</code> for last 4 of 60 activity records. 2 "Cardiac below thresh" messages.
            </dd>
            <dt>Remaining Limitation</dt>
            <dd>Scenarios 21 (VF) and 22 (VT&rarr;VF) still produce zero alarms. This is a <strong>different issue</strong>: VF/VT generates high-amplitude chaotic PPG that exceeds the amplitude threshold (75), so the below-threshold branch is never entered. See NEW bug "VF/VT Blindness" below.</dd>
        </dl>
    </div>
</div>

<!-- BUG-5 -->
<div class="bug-card bug-p1" style="opacity: 0.7;">
    <div class="bug-header" style="background: var(--success-bg); color: var(--success); border-left: 4px solid var(--success);">
        <span>BUG-5: Shadowed Variable Prevents Gap-Based Alarm</span>
        <span class="badge badge-pass">FIXED</span>
    </div>
    <div class="bug-body">
        <dl>
            <dt>Symptom (resolved)</dt>
            <dd>The gap-detection alarm ("Cardiac Alarm ON!") could never fire because a local variable shadowed the global <code>last_peak_above_threshold</code>.</dd>
            <dt>Root Cause (was)</dt>
            <dd>Local variable <code>float last_peak_above_threshold = 0.0;</code> at <code>corsano_cardiac_arrest.c:233</code> shadowed the global at line 143. Every function call started with the local at 0.0, making the gap condition always false.</dd>
            <dt>Resolution</dt>
            <dd>Source code comment at line 233 confirms: <code>// BUG-5 FIX: removed local 'last_peak_above_threshold' that shadowed global (line 143)</code>. The global variable at line 143 is now the only declaration. Fix verified working: scenario 24 (PEA) fires "Cardiac Alarm ON!" via the gap-detection path, confirming <code>last_peak_above_threshold</code> retains its value between calls. Scenario 23 fires "Cardiac Alarm2 ON!" (amplitude-based, valid pair) &mdash; also requires the global to persist.</dd>
        </dl>
    </div>
</div>

<!-- NEW: VF/VT Detection Blindness -->
<div class="bug-card bug-p1">
    <div class="bug-header">
        <span>NEW: VF/VT Amplitude Exceeds Detection Threshold &mdash; Algorithm Blind to Lethal Arrhythmias</span>
        <span class="priority p1">P1 &mdash; PATIENT SAFETY</span>
    </div>
    <div class="bug-body">
        <dl>
            <dt>Symptom</dt>
            <dd>Scenarios 21 (VF from sinus) and 22 (VT&rarr;VF) produce <strong>zero alarms</strong>. The cardiac arrest detector shows no activity at all in scenario 22 (0 "below thresh" messages) and minimal activity in scenario 21 (2 "below thresh" messages, max duration 8.2s &mdash; below the 10s alarm threshold). The device reports HR 117-177 bpm with <code>cardiac_arrest=1</code> (NORMAL_RYTHM) throughout VF/VT.</dd>
            <dt>Affected Scenarios</dt>
            <dd>21_vf_from_sinus (2 "below thresh", max 8.2s, 0 alarms), 22_vt_to_vf (0 "below thresh", 0 alarms). Both show <code>cardiac_arrest=1</code> for all 60 activity records.</dd>
            <dt>Root Cause</dt>
            <dd>The cardiac arrest detection algorithm at <code>corsano_cardiac_arrest.c</code> is designed for scenarios where pulsations <strong>disappear</strong> (asystole, PEA). It uses an amplitude threshold of 75 (line 235: <code>float threshold = 75</code>). VF and VT produce the opposite &mdash; large, chaotic high-frequency PPG oscillations with <code>amplitude_difference > 75</code>. The below-threshold branch is rarely or never entered, and <code>below_threshold_duration</code> cannot accumulate past the 10s minimum. The algorithm is fundamentally blind to high-amplitude lethal arrhythmias.</dd>
            <dt>Evidence</dt>
            <dd>
<pre><code>// Scenario 21 (VF from sinus) -- only 2 brief below-thresh events:
Cardiac below thresh 8.2 8.2.   // 8.2s < 10s minimum → no alarm
Cardiac below thresh 7.6 7.6.   // 7.6s < 10s minimum → no alarm

// HR during VF phase (last 5 minutes):
HR=117, quality=1  // VF chaotic oscillations interpreted as fast HR
HR=128, quality=1
HR=130, quality=1
HR=142, quality=1
HR=148, quality=1  // device reports "fast but normal" rhythm

// Scenario 22 (VT→VF) -- ZERO detection activity:
// Only message: "Cardiac INIT."
// VT produces fast regular peaks, VF produces chaotic high peaks
// Both exceed amplitude threshold 75 → detector never activates</code></pre>
            </dd>
            <dt>Fix</dt>
            <dd>The amplitude-threshold approach fundamentally cannot detect VF or VT. New detection modalities needed:
            <ol style="margin: 8px 0 0 20px;">
                <li><strong>Waveform regularity analysis:</strong> VF produces chaotic inter-peak timing (coefficient of variation &gt; 50%). Normal rhythm has CV &lt; 15%.</li>
                <li><strong>Frequency-domain VF classifier:</strong> VF has dominant frequency 4-8 Hz with broad spectral spread. Normal PPG has a narrow peak at 0.8-3 Hz.</li>
                <li><strong>HR variability spike detection:</strong> Sudden large HR change (&gt; 40 bpm in 1 minute) combined with quality drop to 1 is a strong VF/VT indicator.</li>
                <li><strong>Green amplitude collapse:</strong> When avg amp drops from ~800 (normal) to &lt; 100, flag potential arrest regardless of peak detection.</li>
            </ol>
            </dd>
        </dl>
    </div>
</div>

<!-- BUG-3 -->
<div class="bug-card bug-p2">
    <div class="bug-header">
        <span>BUG-3: HR Doubling by Dicrotic Notch (HR &lt; 55 bpm)</span>
        <span class="priority p2">P2 &mdash; ALGORITHM</span>
    </div>
    <div class="bug-body">
        <dl>
            <dt>Symptom</dt>
            <dd>Heart rate is consistently reported at exactly 2x the true rate for bradycardic patients. Measured/expected ratios: 2.005, 2.145, 1.967, 2.006. Algorithm reports with high confidence (quality=3).</dd>
            <dt>Affected Scenarios</dt>
            <dd>18_bradycardia (42&rarr;84.2 bpm, ratio 2.005), 20_bav3_complete (33&rarr;70.8 bpm, ratio 2.145), 33_hypothermia_32C (55&rarr;108.2 bpm, ratio 1.967), 34_hypothermia_28C (35&rarr;70.2 bpm, ratio 2.006)</dd>
            <dt>Root Cause</dt>
            <dd>Two reinforcing mechanisms exclude the true fundamental frequency, leaving only the 2nd harmonic (dicrotic notch):
            <ol style="margin: 8px 0 0 20px;">
                <li><strong>Bandpass filter cutoff at 0.7 Hz (42 bpm):</strong> At <code>mmt_vital_algorithms.c:281-283</code>, the green channel bandpass filter has <code>lowcut=0.7</code>. At 42 bpm, the fundamental sits at the -3dB point (50% power attenuation). At 35 bpm (0.58 Hz), it is heavily suppressed (&gt;-10 dB). The 2nd harmonic passes unattenuated.</li>
                <li><strong>FFT search floor at 45 bpm:</strong> At <code>mmt_vital_algorithms.c:70</code>, <code>#define LOW_BPM_50 45.0</code> sets the FFT search window to bin 24 (45 bpm). A 42 bpm fundamental maps to bin 22.4, <strong>below</strong> the search floor. A 33 bpm fundamental maps to bin 17.6, far below. Only the doubled frequency is found.</li>
            </ol>
            Once locked to the doubled frequency, <code>prev_hr > 80</code> raises the search floor to 50-65 bpm (lines 3626, 3695), and the jump limiter (~4 bpm/step, lines 3677-3685) prevents recovery. The algorithm permanently latches to the 2nd harmonic.</dd>
            <dt>Evidence</dt>
            <dd>
                <table>
                    <tr><th>Scenario</th><th>Expected HR</th><th>Measured HR</th><th>Ratio</th><th>HR Std</th><th>Quality</th></tr>
                    <tr><td>18_bradycardia</td><td>42</td><td>84.2</td><td><span class="ratio-highlight">2.005</span></td><td>0.7</td><td>3 (high)</td></tr>
                    <tr><td>20_bav3_complete</td><td>33</td><td>70.8</td><td><span class="ratio-highlight">2.145</span></td><td>0.5</td><td>3 (high)</td></tr>
                    <tr><td>33_hypothermia_32C</td><td>55</td><td>108.2</td><td><span class="ratio-highlight">1.967</span></td><td>2.5</td><td>1-2 (low*)</td></tr>
                    <tr><td>34_hypothermia_28C</td><td>35</td><td>70.2</td><td><span class="ratio-highlight">2.006</span></td><td>0.5</td><td>3 (high)</td></tr>
                </table>
                <p style="font-size:0.85em;">* Scenario 33 has additional shivering noise (BUG-6 interaction), reducing quality and adding HR variance.</p>
            </dd>
            <dt>Fix (3-level approach)</dt>
            <dd>
            <ol style="margin: 0 0 0 20px;">
                <li><strong>Lower bandpass filter cutoff</strong> (<code>mmt_vital_algorithms.c:283</code>): Redesign with <code>lowcut=0.4 Hz</code> (24 bpm) instead of 0.7 Hz (42 bpm)</li>
                <li><strong>Lower FFT search floor</strong> (<code>mmt_vital_algorithms.c:70</code>): Change <code>LOW_BPM_50</code> from 45.0 to 25.0 to include bradycardic fundamentals</li>
                <li><strong>Add sub-harmonic checking</strong>: After finding the dominant FFT peak at frequency f, check for significant energy at f/2. If <code>peak_at_f/2 / peak_at_f > 0.3</code>, report f/2 as the true HR. Most robust approach.</li>
            </ol>
            </dd>
        </dl>
    </div>
</div>

<!-- NEW: Selection Bias -->
<div class="bug-card bug-p2">
    <div class="bug-header">
        <span>NEW: SpO2 Selection Bias at Extreme R-Ratios</span>
        <span class="priority p2">P2 &mdash; ALGORITHM</span>
    </div>
    <div class="bug-body">
        <dl>
            <dt>Symptom</dt>
            <dd>Scenario 06 (severe hypoxia, target SpO2=72%): measured 85.3% (+13.3 delta). Per-beat SpO2 values scatter wildly from 50 to 94 in the same window.</dd>
            <dt>Root Cause</dt>
            <dd>Two compounding mechanisms: (1) At R ~1.5 (SpO2 ~72%), the quality filter at <code>mmt_vital_algorithms.c:4574</code> (<code>if (R > 2) good = false</code>) and the <code>spo2_std > 10</code> filter systematically reject the most hypoxic beats (highest R values) while keeping beats where noise accidentally lowered R. This creates a <strong>positive selection bias</strong>. (2) The <code>Proc_spo2</code> rolling average initializes at 100% and converges too slowly for severely low SpO2 &mdash; only ~12% of windows produce valid SpO2, with early values near 99% dragging the average up to 85.3%.</dd>
            <dt>Evidence</dt>
            <dd>TTT1 log: R = 1.517 (expected 1.401). Per-beat scatter: <code>Spo2s__1,88.14,82.10,58.23,65.14,88.36,65.11,61.80,55.04</code> &mdash; same window, values range from 55 to 88. The <code>avg_good(69.2,3)</code> intermediate correctly tracks near 72%, but downstream pipeline raises final value to 85.3%.</dd>
            <dt>Fix</dt>
            <dd>Implement adaptive R-ratio quality thresholds based on the running R estimate. For R &gt; 1.2 (SpO2 &lt; 78%), widen the acceptance window or use median instead of mean.</dd>
        </dl>
    </div>
</div>

<!-- BUG-1 -->
<div class="bug-card bug-p2">
    <div class="bug-header">
        <span>BUG-1: SpO2 old_mid Formula +5 Offset Bias</span>
        <span class="priority p2">P2 &mdash; ALGORITHM</span>
    </div>
    <div class="bug-body">
        <dl>
            <dt>Symptom</dt>
            <dd>The <code>old_mid</code> SpO2 values are consistently 3-5 points higher than <code>avg_good</code> values.</dd>
            <dt>Root Cause</dt>
            <dd>The formula at <code>mmt_vital_algorithms.c:5325</code> contains a hardcoded <code>+5</code> offset:
<pre><code>float y = 1.595 * x * x - 32.67 * x + 112.69 + 5;</code></pre>
                This produces SpO2 = 94.8 instead of 90.5 for R = 0.726 (scenario 04).</dd>
            <dt>Status</dt>
            <dd>The current firmware code path uses <code>spo2_avg_good</code> (tuned curve) for the final <code>SPO2_F</code> output. However, if the analysis pipeline or any fallback path uses <code>old_mid</code>, the bias appears.</dd>
            <dt>Fix</dt>
            <dd>Remove the <code>+5</code> constant from the old_mid formula, or ensure the analysis pipeline exclusively reads <code>SPO2_F</code> values.</dd>
        </dl>
    </div>
</div>

<!-- BUG-6 -->
<div class="bug-card bug-p3">
    <div class="bug-header">
        <span>BUG-6: Movement Detection Mismatch &mdash; mmt_idle_detection vs PSP Classifier</span>
        <span class="priority p3">P3 &mdash; SIMULATOR / FIRMWARE</span>
    </div>
    <div class="bug-body">
        <dl>
            <dt>Symptom</dt>
            <dd>Scenario 33 (hypothermia 32&deg;C with shivering): PSP classifier correctly classifies as REST (variance threshold raised to 20k), but <code>mmt_idle_detection</code> returns ACTIVE(4), causing 100% SpO2 movement rejection. SpO2=0 for all 60 minutes.</dd>
            <dt>Root Cause</dt>
            <dd>Two independent motion-detection systems use incompatible metrics: PSP uses per-second variance (threshold 20k), while <code>mmt_idle_detection.c:256-270</code> uses sum of Euclidean sample-to-sample deltas over 100 samples. For 10 Hz shivering at 0.15g (154 counts), <code>sum_d_acc</code> reaches ~36,600, far above the ACTIVE threshold of 2,700 at line 175. The SpO2 filter at <code>mmt_vital_algorithms.c:5956</code> then zeros SpO2 when <code>movement_level &gt; ALMOST_IDLE(1)</code>.</dd>
            <dt>Impact</dt>
            <dd>SpO2 completely suppressed during shivering despite being stationary. Also amplifies BUG-3: the low quality prevents quality-enhancement filters, making HR doubling noisier (std=2.5 vs &lt;1.0 for pure BUG-3 scenarios).</dd>
            <dt>Scenario 34 (28&deg;C, no shivering) &mdash; Different SpO2=0 mechanism</dt>
            <dd>No movement issue (IDLE). SpO2=0 because Red-IR peak alignment mismatch (<code>time_diff</code> 4.2-7.0s) exceeds the fixed 4.0s threshold at <code>mmt_vital_algorithms.c:5989</code>. At 35 bpm with 30% DC levels and noise_std=200, peak detection is too imprecise. Valid SpO2=82 readings are rejected. Fix: scale threshold with HR: <code>threshold = max(4.0, 60.0/HR * 2.5)</code>.</dd>
        </dl>
    </div>
</div>

<!-- FIXED: Analysis Script Wrong Values -->
<div class="bug-card bug-p3" style="opacity: 0.7;">
    <div class="bug-header" style="background: var(--success-bg); color: var(--success); border-left: 4px solid var(--success);">
        <span>FIXED: Analysis Script Wrong Expected HR Values</span>
        <span class="badge badge-pass">FIXED</span>
    </div>
    <div class="bug-body">
        <dl>
            <dt>Symptom (resolved)</dt>
            <dd>Scenarios 26 and 30 were flagged as WARN despite firmware measuring correctly.</dd>
            <dt>Root Cause</dt>
            <dd><code>analyze_golden_results.py</code> was using expected HR = 95 (scenario 26) and 100 (scenario 30), but metadata specifies 110 and 115 respectively.</dd>
            <dt>Resolution</dt>
            <dd>Expected values updated to match metadata. Both scenarios now PASS correctly (delta 2.8 and 3.2 bpm).</dd>
        </dl>
    </div>
</div>

<!-- FIXED: Hemorrhagic Shock Low SNR -->
<div class="bug-card bug-p3" style="opacity: 0.7;">
    <div class="bug-header" style="background: var(--success-bg); color: var(--success); border-left: 4px solid var(--success);">
        <span>FIXED: Hemorrhagic Shock Low-SNR SpO2 (Scenario 32)</span>
        <span class="badge badge-pass">FIXED</span>
    </div>
    <div class="bug-body">
        <dl>
            <dt>Symptom (resolved)</dt>
            <dd>Scenario 32 (hemorrhagic_shock) was flagged as FAIL with SpO2=89.1% vs expected 96% (delta=-6.9).</dd>
            <dt>Root Cause</dt>
            <dd>Generator data produced unrealistically low DC levels (DC_R=21, DC_IR=69) causing high noise-to-signal ratio and erratic R-ratio computation.</dd>
            <dt>Resolution</dt>
            <dd>Generator data improved with more realistic DC levels for hemorrhagic shock. Scenario 32 now PASS with SpO2=97.3% (delta=+1.3).</dd>
        </dl>
    </div>
</div>

</section>

<!-- ============================================================ -->
<!-- 4. SpO2 DETAILED ANALYSIS -->
<!-- ============================================================ -->
<section id="spo2-analysis">
<h2>4. SpO2 Detailed Analysis</h2>

<h3>R-Ratio Verification</h3>
<p>SpO2 is computed from the ratio of ratios: <code>R = (AC_red/DC_red) / (AC_ir/DC_ir)</code>, then <code>SpO2 = 112.1152 - 28.6318 &times; R</code> (legacy quadratic: <code>108.49 - 30.09*R - 0.031*R&sup2;</code>).</p>

<table>
    <thead>
    <tr><th>Scenario</th><th>Target SpO2</th><th>Generator R</th><th>Observed R (TTT1)</th><th>Default Curve SpO2</th><th>Tuned SpO2</th><th>Reported SpO2</th><th>Delta</th></tr>
    </thead>
    <tbody>
    <tr><td>01_normal_rest</td><td>98</td><td>0.493</td><td>~0.49</td><td>98.0</td><td>97.4</td><td>99.0</td><td>+1.0</td></tr>
    <tr><td>04_hypoxia_mild</td><td>92</td><td>0.703</td><td>0.726</td><td>91.3</td><td>90.5</td><td>95.4</td><td>+3.4</td></tr>
    <tr><td>05_hypoxia_moderate</td><td>85</td><td>0.947</td><td>~0.95</td><td>84.9</td><td>83.8</td><td>83.6</td><td>-1.4</td></tr>
    <tr style="background: var(--fail-bg);">
        <td>06_hypoxia_severe</td><td>72</td><td>1.401</td><td>1.517</td><td>68.7</td><td>66.9</td><td>85.3</td><td style="color:var(--fail); font-weight:bold;">+13.3</td>
    </tr>
    <tr style="background: var(--success-bg);">
        <td>32_hemorrhagic_shock</td><td>96</td><td>0.563</td><td>~0.56</td><td>96.0</td><td>95.3</td><td>97.3</td><td style="color:var(--success);">+1.3</td>
    </tr>
    </tbody>
</table>

<h3>Key SpO2 Findings</h3>

<div class="finding-box">
    <strong>06_hypoxia_severe:</strong> Two compounding issues cause the +13.3 point deviation: (1) The quality filter (R &gt; 2 cutoff + spo2_std &gt; 10) creates selection bias, rejecting the most hypoxic beats while keeping beats where noise lowered R. (2) The <code>Proc_spo2</code> rolling average initializes at 100% and converges very slowly toward the true ~72%, with sparse non-zero SpO2 values. Manual R calculation from TTT1: R = (192/27000)/(403/86000) = 1.517 &rarr; SpO2 = 62.8% (correct for target 72%). But the per-beat scatter is enormous:
<pre><code>Spo2s__1, 88.14, 82.10, 58.23, 65.14, 88.36, 65.11, 61.80, 55.04, 69.92
Spo2s__1, 75.20, 83.53, 62.79, 62.66, 67.89, 70.99, 79.03, 79.43</code></pre>
    The <code>avg_good</code> intermediate correctly yields ~69% (close to truth), but upstream pipeline averaging, quality gating (SPO2_F first-low filtered), and <code>Proc_spo2</code> rolling average initialization at 100% pull the final reported value up to 85.3%. Only ~12% of windows produce valid SpO2 (<code>spo2_quality_pct: 12.1%</code>). No "venous pooling" messages found (BUG-2 not triggered, as <code>sleep_recording=false</code> in sim).
</div>

<div class="finding-box" style="border-left-color: var(--success);">
    <strong>32_hemorrhagic_shock:</strong> <strong style="color: var(--success);">RESOLVED</strong> &mdash; Previously failed with SpO2=89.1% (delta=-6.9) due to low-SNR generator data. Now passes with SpO2=97.3% (delta=+1.3) after generator data improvement. DC levels and R-ratio now produce realistic values for the target SpO2 of 96%.
</div>

<div class="finding-box">
    <strong>04_hypoxia_mild:</strong> TTT1 confirms mild desaturation (PI_IR ~5.9-6.1 &gt; PI_R ~4.2-4.3). The <code>avg_good</code> path reports 91.1% (close to target 92%), but a hardcoded <code>+2</code> offset at <code>mmt_process_fxi.c:2655-2658</code> is applied when SpO2 is between 90-98%:
<pre><code>if ((mmt_activity_output.spo2 > 90) && (mmt_activity_output.spo2 < 98))
    mmt_activity_output.spo2 = mmt_activity_output.spo2 + 2;</code></pre>
    Per-beat SPO2_F outputs ~91 consistently. After the +2 bias and rolling average smoothing, the final reported value is 95.4% (+3.4 delta). Per-beat values cluster tightly at 90-93 (good consistency).
</div>

<h3>SpO2 Accuracy by Category</h3>
<table>
    <thead><tr><th>Category</th><th>Scenarios</th><th>Mean Abs Delta</th><th>Pass Rate</th></tr></thead>
    <tbody>
    <tr><td>Normal (SpO2 &ge; 96%)</td><td>23</td><td>1.2</td><td>100%</td></tr>
    <tr><td>Mild Hypoxia (90-95%)</td><td>3</td><td>2.8</td><td>67%</td></tr>
    <tr><td>Severe Hypoxia (&lt; 90%)</td><td>1</td><td>13.3</td><td>0%</td></tr>
    </tbody>
</table>
</section>

<!-- ============================================================ -->
<!-- 5. HR DETAILED ANALYSIS -->
<!-- ============================================================ -->
<section id="hr-analysis">
<h2>5. HR Detailed Analysis</h2>

<h3>HR Doubling Evidence</h3>
<p>Four scenarios show the classic dicrotic notch doubling signature: measured/expected ratio approximately 2.0 with very low standard deviation.</p>

<table>
    <thead><tr><th>Scenario</th><th>Expected HR</th><th>Measured HR</th><th>Ratio</th><th>Std Dev</th><th>Quality</th><th>Notch Depth</th></tr></thead>
    <tbody>
    <tr style="background: var(--fail-bg);">
        <td>18_bradycardia</td><td>42</td><td>84.2</td><td><span class="ratio-highlight">2.005</span></td><td>0.7</td><td>3</td><td>0.06</td>
    </tr>
    <tr style="background: var(--fail-bg);">
        <td>20_bav3_complete</td><td>33</td><td>70.8</td><td><span class="ratio-highlight">2.145</span></td><td>0.5</td><td>3</td><td>0.04</td>
    </tr>
    <tr style="background: var(--fail-bg);">
        <td>33_hypothermia_32C</td><td>55</td><td>108.2</td><td><span class="ratio-highlight">1.967</span></td><td>2.5</td><td>1-2</td><td>0.05</td>
    </tr>
    <tr style="background: var(--fail-bg);">
        <td>34_hypothermia_28C</td><td>35</td><td>70.2</td><td><span class="ratio-highlight">2.006</span></td><td>0.5</td><td>3</td><td>0.05</td>
    </tr>
    </tbody>
</table>

<div class="alert-box alert-fail">
    <strong>Critical observation:</strong> The algorithm reports doubled HR with quality=3 (highest confidence). This means downstream consumers (clinical alerts, activity tracking) will trust the incorrect value. A patient with 35 bpm bradycardia would appear to have a normal 70 bpm heart rate.
</div>

<h3>HR Accuracy by Category</h3>
<table>
    <thead><tr><th>Category</th><th>Scenarios</th><th>Mean Abs Delta</th><th>Pass Rate</th><th>Notes</th></tr></thead>
    <tbody>
    <tr><td>Rest (60-100 bpm)</td><td>3</td><td>4.5</td><td>100%</td><td>Excellent accuracy</td></tr>
    <tr><td>Tachycardia (&gt;100 bpm)</td><td>6</td><td>5.5</td><td>100%</td><td>Good accuracy</td></tr>
    <tr style="background: var(--fail-bg);"><td>Bradycardia (&lt;55 bpm)</td><td>4</td><td>39.4</td><td>0%</td><td>All doubled (BUG-3)</td></tr>
    <tr><td>Arrhythmias</td><td>8</td><td>3.3</td><td>100%</td><td>Excellent for AF, flutter, ESV</td></tr>
    <tr><td>Activity</td><td>3</td><td>5.6</td><td>100%</td><td>Good during motion</td></tr>
    </tbody>
</table>

<h3>Previously False WARNs (Now Fixed)</h3>
<div class="finding-box" style="border-left-color: var(--success);">
    <strong>Scenarios 26 (pulsus alternans) and 30 (tamponade):</strong> Previously flagged as WARN due to incorrect expected HR values in the analysis script (95 and 100 bpm instead of 110 and 115 bpm). <strong>Now fixed</strong> &mdash; both scenarios PASS with deltas of 2.8 and 3.2 bpm respectively.
</div>
</section>

<!-- ============================================================ -->
<!-- 6. CARDIAC ARREST ANALYSIS -->
<!-- ============================================================ -->
<section id="cardiac-arrest-analysis">
<h2>6. Cardiac Arrest Detection Analysis</h2>

<div class="alert-box alert-fail">
    <strong>CRITICAL SAFETY FINDING:</strong> Cardiac arrest detection now <strong>works correctly for asystole and PEA</strong> (scenarios 23, 24) &mdash; alarms fire and stay ON thanks to FIX-2 recovery rejection logic. However, detection remains <strong>fundamentally blind to VF and VT</strong> (scenarios 21, 22) &mdash; zero alarms in both scenarios. The amplitude-threshold algorithm cannot detect high-amplitude chaotic arrhythmias. A new detection modality (regularity analysis, frequency-domain classifier) is required for VF/VT.
</div>

<h3>Per-Scenario Timeline</h3>
<table>
    <thead>
    <tr><th>Scenario</th><th>Arrest Type</th><th>"Below Thresh" Count</th><th>Max Duration Reached</th><th>Alarm Fired?</th><th>HR During Arrest</th><th>SpO2 During Arrest</th></tr>
    </thead>
    <tbody>
    <tr>
        <td>21_vf_from_sinus</td><td>VF</td><td>2</td><td>8.2s</td><td style="color:var(--fail); font-weight:bold;">NO &mdash; VF blindness</td><td>75-148 bpm</td><td>98%</td>
    </tr>
    <tr>
        <td>22_vt_to_vf</td><td>VT&rarr;VF</td><td style="color:var(--fail); font-weight:bold;">0</td><td>N/A</td><td style="color:var(--fail); font-weight:bold;">NO &mdash; VT/VF blindness</td><td>81-177 bpm</td><td>98%</td>
    </tr>
    <tr>
        <td>23_asystole</td><td>Asystole</td><td>54</td><td>&gt;10s</td><td style="color:var(--success); font-weight:bold;">YES &mdash; stays ON (8 recovery rejections)</td><td>71-108 bpm</td><td>97%</td>
    </tr>
    <tr>
        <td>24_pea</td><td>PEA</td><td>2</td><td>&gt;10s</td><td style="color:var(--success); font-weight:bold;">YES &mdash; stays ON (13 recovery rejections)</td><td>80-103 bpm</td><td>98%</td>
    </tr>
    </tbody>
</table>

<h3>Detection Status by Arrest Type</h3>
<div class="finding-box">
    After BUG-4, BUG-5, and FIX-2 (recovery rejection):
    <ol>
        <li><del><strong>BUG-4 (FIXED)</strong>: Invalid-pair alarm check works + FIX-2 recovery rejection prevents false alarm-OFF.</del></li>
        <li><del><strong>BUG-5 (FIXED)</strong>: Shadowed variable removed &rarr; gap-based alarm functional.</del></li>
        <li style="color: var(--success);"><strong>Asystole (scenario 23): DETECTED.</strong> Alarm fires via Alarm3 (invalid-pair path) and stays ON. 54 "below thresh" messages, 8 recovery rejections. <code>cardiac_arrest=2</code> for last 5 of 60 records.</li>
        <li style="color: var(--success);"><strong>PEA (scenario 24): DETECTED.</strong> Alarm fires via gap-detection path ("Cardiac Alarm ON!") and stays ON. 13 recovery rejections. <code>cardiac_arrest=2</code> for last 4 of 60 records.</li>
        <li style="color: var(--fail);"><strong>VF (scenario 21): NOT DETECTED.</strong> VF produces chaotic high-amplitude PPG (&gt; threshold 75). Only 2 brief below-thresh events (max 8.2s &lt; 10s min). Zero alarms.</li>
        <li style="color: var(--fail);"><strong>VT&rarr;VF (scenario 22): NOT DETECTED.</strong> VT produces fast regular high-amplitude peaks; VF produces chaotic peaks. Both exceed threshold. Zero below-thresh events. Zero alarms. Worst case &mdash; complete detection failure.</li>
    </ol>
</div>

<h3>Additional Concerns</h3>
<ul>
    <li><strong>False HR during arrest:</strong> All 4 scenarios report HR 71-177 bpm during arrest phases. HR comes from the internal FFT-based PR algorithm in <code>mmt_vital_algorithms.c</code> (PSP stub does not emit HR metric). The <code>HRM_filtered</code> buffer retains historical values and decays slowly. In scenario 23, HR drops to 71 during asystole but never reaches 0.</li>
    <li><strong>No HR suppression when alarm active:</strong> The HR reporting logic at <code>mmt_process_fxi.c:1605-1685</code> does not check <code>corsano_cardiac_get_state()</code>. Even when <code>cardiac_arrest=2</code> (scenarios 23, 24), the firmware continues reporting non-zero HR. A patient in cardiac arrest should show HR=0.</li>
    <li><strong>False SpO2 during arrest:</strong> All scenarios report SpO2 95-100% during arrest &mdash; physiologically impossible.</li>
    <li><strong>LED auto-gain masks signal loss:</strong> When green amplitude drops from ~800 to ~35, LED power increases from 1% to 60%, making the signal appear "present" to the algorithm despite no actual pulse.</li>
    <li><strong>Scenario 22 (VT&rarr;VF) is worst case:</strong> Zero detection activity across the entire simulation. VT and VF phases both produce high-amplitude peaks that fool the amplitude-based detector. HR reaches 177 bpm during VF. The device appears completely unaware of the lethal arrhythmia.</li>
    <li><strong>Scenario 24 (PEA) detection quality:</strong> The alarm fires correctly, but HR is still reported at 80-103 bpm during PEA. The quality drops from 3 to 1 during the arrest phase, which is the only secondary indicator. A clinician relying solely on HR would see normal values.</li>
</ul>
</section>

<!-- ============================================================ -->
<!-- 7. RESULTS BY CATEGORY -->
<!-- ============================================================ -->
<section id="results-by-category">
<h2>7. Results by Category</h2>

<h3>Rest (Scenarios 01-03)</h3>
<div class="finding-box">
    <strong>3/3 PASS.</strong> HR accuracy excellent (&Delta; 0.9-10.7 bpm). SpO2 within &plusmn;1.3 points. Wearing detection works correctly (minute 1). Activity correctly classified as REST. No issues.
</div>

<h3>Hypoxia (Scenarios 04-06)</h3>
<div class="finding-box">
    <strong>1 PASS, 1 WARN, 1 FAIL.</strong> Moderate hypoxia (SpO2=85%) works well. Mild hypoxia shows +3.4 bias (BUG-1 + rolling avg init at 100%). Severe hypoxia (SpO2=72%) has critical +13.3 bias from selection filter and rolling avg convergence (NEW bug). <strong>Conclusion: SpO2 accuracy degrades significantly below 80%.</strong>
</div>

<h3>Activity (Scenarios 07-09)</h3>
<div class="finding-box">
    <strong>3/3 PASS.</strong> Walking and running HR within tolerance. SpO2 correctly suppressed during motion (movement rejection active). Step counting operational. Activity classification correct (WALK/RUN).
</div>

<h3>Arrhythmias (Scenarios 10-17)</h3>
<div class="finding-box">
    <strong>8/8 PASS.</strong> Excellent performance across AF (rapid and controlled), flutter, ESV (bigeminy/trigeminy), PSVT, VT monomorphic, and torsades. HR accuracy within 0.5-8.4 bpm for all arrhythmia types. This is the strongest category.
</div>

<h3>Bradycardia (Scenarios 18-20)</h3>
<div class="finding-box">
    <strong>1 PASS, 2 FAIL.</strong> Scenario 19 (Mobitz I, variable rate) passes. Scenarios 18 (42 bpm) and 20 (33 bpm) show exact HR doubling (BUG-3). <strong>Conclusion: All fixed-rate bradycardia &lt; 55 bpm fails due to dicrotic notch.</strong>
</div>

<h3>Cardiac Arrest (Scenarios 21-24)</h3>
<div class="finding-box">
    <strong>2/4 detected correctly, 2/4 undetected.</strong> All 4 scenarios WARN. <strong>Improvement:</strong> Scenarios 23 (asystole) and 24 (PEA) now correctly detect arrest &mdash; alarms fire and stay ON thanks to FIX-2 recovery rejection. <code>cardiac_arrest=2</code> for last 5 records (scenario 23) and 4 records (scenario 24). <strong>Critical gap:</strong> Scenarios 21 (VF) and 22 (VT&rarr;VF) produce zero alarms due to VF/VT amplitude exceeding the detection threshold. HR and SpO2 continue reporting normal-appearing values during all arrest types. See <a href="#cardiac-arrest-analysis">Section 6</a>.
</div>

<h3>Cardiac Pathologies (Scenarios 25-31)</h3>
<div class="finding-box">
    <strong>7/7 PASS.</strong> Progressive deterioration, Cheyne-Stokes, aortic stenosis/regurgitation, HCM, pulsus alternans, and tamponade all pass. Previous false WARNs on scenarios 26 and 30 have been resolved by fixing the analysis script expected HR values. This is the strongest category alongside arrhythmias.
</div>

<h3>Extreme Conditions (Scenarios 32-40)</h3>
<div class="finding-box">
    <strong>7 PASS, 2 FAIL.</strong> Hemorrhagic shock now passes (SpO2=97.3%, previously failed). Scenario 33 (32&deg;C) fails with HR doubling + shivering: PSP classifier correctly returns REST, but <code>mmt_idle_detection</code> returns ACTIVE(4) causing 100% SpO2 rejection (BUG-6 mismatch). Scenario 34 (28&deg;C) fails with HR doubling + SpO2=0 from Red-IR peak misalignment (<code>time_diff</code> 4.2-7.0s exceeds fixed 4.0s threshold at 35 bpm). Sleep apnea, vasovagal syncope, venous pooling, severe anemia, Parkinson tremor, and CO poisoning all pass.
</div>
</section>

<!-- ============================================================ -->
<!-- 8. RECOMMENDATIONS -->
<!-- ============================================================ -->
<section id="recommendations">
<h2>8. Recommendations</h2>

<h3><span class="priority p1">P1</span> Patient Safety &mdash; Immediate Action Required</h3>
<table>
    <thead><tr><th>#</th><th>Action</th><th>File</th><th>Status</th><th>Impact</th></tr></thead>
    <tbody>
    <tr style="opacity: 0.6; text-decoration: line-through;">
        <td>1</td>
        <td>Add alarm condition check in invalid-pair branch &mdash; <strong style="text-decoration: none; color: var(--success);">DONE</strong></td>
        <td><code>corsano_cardiac_arrest.c:349-359</code></td>
        <td><span class="badge badge-pass">FIXED</span></td>
        <td>Alarm3 ON fires and stays ON in scenarios 23, 24</td>
    </tr>
    <tr style="opacity: 0.6; text-decoration: line-through;">
        <td>2</td>
        <td>Remove local <code>last_peak_above_threshold</code> variable shadow &mdash; <strong style="text-decoration: none; color: var(--success);">DONE</strong></td>
        <td><code>corsano_cardiac_arrest.c:233</code></td>
        <td><span class="badge badge-pass">FIXED</span></td>
        <td>Gap-based alarm now functional (scenario 24)</td>
    </tr>
    <tr style="opacity: 0.6; text-decoration: line-through;">
        <td>2b</td>
        <td>FIX-2: Recovery rejection with inter-peak timing validation &mdash; <strong style="text-decoration: none; color: var(--success);">DONE</strong></td>
        <td><code>corsano_cardiac_arrest.c:297-330</code></td>
        <td><span class="badge badge-pass">FIXED</span></td>
        <td>Prevents alarm-OFF from noise. Scenario 23: 8 rejections, scenario 24: 13 rejections</td>
    </tr>
    <tr>
        <td>3</td>
        <td><strong>Implement VF/VT detection modality</strong> &mdash; regularity analysis or frequency-domain VF classifier</td>
        <td><code>corsano_cardiac_arrest.c</code> (new logic)</td>
        <td><span class="badge badge-fail">OPEN</span></td>
        <td>Critical: amplitude-threshold approach is blind to VF/VT. Scenarios 21, 22 have zero alarms. Need waveform regularity analysis (VF CV &gt; 50%), HR variability spike detection, or spectral analysis.</td>
    </tr>
    <tr>
        <td>3b</td>
        <td>Suppress HR output when <code>cardiac_arrest</code> state is active</td>
        <td><code>mmt_process_fxi.c:~1628</code></td>
        <td><span class="badge badge-fail">OPEN</span></td>
        <td>Ensures HR=0 reported during detected arrest. Currently HR 71-108 during asystole/PEA despite <code>cardiac_arrest=2</code>.</td>
    </tr>
    <tr>
        <td>3c</td>
        <td>Add amplitude gating: when green avg amp &lt; 100 (normal ~800), reject all peaks as noise and flag potential arrest</td>
        <td><code>mmt_vital_algorithms.c</code></td>
        <td><span class="badge badge-fail">OPEN</span></td>
        <td>Prevents false HR during arrest (LED auto-gain compensation). Could serve as secondary VF indicator.</td>
    </tr>
    </tbody>
</table>

<h3><span class="priority p2">P2</span> Algorithm Improvements</h3>
<table>
    <thead><tr><th>#</th><th>Action</th><th>File</th><th>Impact</th></tr></thead>
    <tbody>
    <tr>
        <td>4a</td>
        <td>Lower bandpass filter cutoff from 0.7 Hz to 0.4 Hz (24 bpm)</td>
        <td><code>mmt_vital_algorithms.c:281-283</code></td>
        <td>Preserves fundamental frequency for bradycardic signals (BUG-3)</td>
    </tr>
    <tr>
        <td>4b</td>
        <td>Lower FFT search floor from 45 bpm to 25 bpm (<code>LOW_BPM_50</code>)</td>
        <td><code>mmt_vital_algorithms.c:70</code></td>
        <td>Allows detection of true bradycardic fundamental (BUG-3)</td>
    </tr>
    <tr>
        <td>4c</td>
        <td>Add sub-harmonic checking: if peak at f/2 has &gt;30% of peak at f, report f/2</td>
        <td><code>mmt_vital_algorithms.c:3585-3690</code></td>
        <td>Most robust fix for dicrotic notch doubling (BUG-3)</td>
    </tr>
    <tr>
        <td>5</td>
        <td>Implement adaptive R-ratio quality thresholds for low SpO2 (R &gt; 1.2): widen "spo2 bads" threshold, use median instead of mean, initialize <code>Proc_spo2</code> rolling to first valid value (not 100%)</td>
        <td><code>mmt_vital_algorithms.c:4574, 5956</code></td>
        <td>Fixes SpO2 selection bias + slow convergence at severe hypoxia</td>
    </tr>
    <tr>
        <td>6</td>
        <td>Remove <code>+5</code> constant from old_mid SpO2 formula; also investigate hardcoded <code>+2</code> offset at <code>mmt_process_fxi.c:2655-2658</code></td>
        <td><code>mmt_vital_algorithms.c:5325</code>, <code>mmt_process_fxi.c:2655</code></td>
        <td>Eliminates SpO2 upward bias (BUG-1): +5 in old_mid, +2 in activity output</td>
    </tr>
    </tbody>
</table>

<h3><span class="priority p3">P3</span> Simulator / Tooling</h3>
<table>
    <thead><tr><th>#</th><th>Action</th><th>File</th><th>Impact</th></tr></thead>
    <tbody>
    <tr style="opacity: 0.6; text-decoration: line-through;">
        <td>7</td>
        <td>Update expected HR values for scenarios 26 (95&rarr;110) and 30 (100&rarr;115) &mdash; <strong style="text-decoration: none; color: var(--success);">DONE</strong></td>
        <td><code>analyze_golden_results.py</code></td>
        <td>Eliminated 2 false WARNs</td>
    </tr>
    <tr style="opacity: 0.6; text-decoration: line-through;">
        <td>8</td>
        <td>Scale noise_std proportionally with DC levels in hemorrhagic shock scenario &mdash; <strong style="text-decoration: none; color: var(--success);">DONE</strong></td>
        <td><code>generate.py</code></td>
        <td>Scenario 32 now PASS (SpO2 97.3%)</td>
    </tr>
    <tr>
        <td>9</td>
        <td>Fix <code>mmt_idle_detection</code> thresholds to be frequency-aware (oscillatory tremor at 8-13 Hz should not trigger ACTIVE). Options: high-pass filter before <code>sum_d_acc</code>, or raise ACTIVE threshold above shivering floor (~40k)</td>
        <td><code>mmt_idle_detection.c:167-175</code></td>
        <td>Fixes SpO2 suppression during shivering (BUG-6). Note: PSP classifier already handles shivering correctly.</td>
    </tr>
    <tr>
        <td>10</td>
        <td>Scale <code>time_diff</code> threshold at <code>mmt_vital_algorithms.c:5989</code> with detected HR: <code>threshold = max(4.0, 60.0/HR * 2.5)</code></td>
        <td><code>mmt_vital_algorithms.c:5989</code></td>
        <td>Fixes SpO2=0 for scenario 34 (28&deg;C hypothermia) where valid SpO2=82 readings are rejected</td>
    </tr>
    </tbody>
</table>
</section>

<!-- ============================================================ -->
<!-- 9. IMPACT MATRIX -->
<!-- ============================================================ -->
<section id="impact-matrix">
<h2>9. Impact Matrix</h2>

<table>
    <thead>
    <tr>
        <th>Bug ID</th>
        <th>Clinical Impact</th>
        <th>Patient Population</th>
        <th>Frequency</th>
        <th>Severity</th>
        <th>Priority</th>
    </tr>
    </thead>
    <tbody>
    <tr style="background: var(--fail-bg);">
        <td>NEW (VF/VT blindness)</td>
        <td>VF and VT produce zero alarms &mdash; amplitude-threshold detector is fundamentally blind to high-amplitude chaotic arrhythmias. Patient in VF/VT would receive no alarm. Asystole and PEA now correctly detected (BUG-4 FIXED + FIX-2).</td>
        <td>All patients experiencing VF or VT</td>
        <td>100% of VF/VT events (2/4 arrest scenarios)</td>
        <td style="color:var(--fail); font-weight:bold;">CRITICAL</td>
        <td><span class="priority p1">P1</span></td>
    </tr>
    <tr style="background: var(--fail-bg);">
        <td>BUG-3</td>
        <td>Bradycardia masked as normal HR &mdash; missed diagnosis, wrong treatment decisions</td>
        <td>Elderly, athletes, AV block, hypothermia (HR &lt; 55 bpm)</td>
        <td>100% at HR &lt; 55</td>
        <td style="color:var(--fail); font-weight:bold;">HIGH</td>
        <td><span class="priority p2">P2</span></td>
    </tr>
    <tr>
        <td>NEW (selection bias + rolling avg)</td>
        <td>Severe hypoxia under-reported (+13.3 pts at SpO2=72%) &mdash; false reassurance at SpO2 &lt; 80%</td>
        <td>COPD exacerbation, respiratory failure, altitude sickness</td>
        <td>High at SpO2 &lt; 80%</td>
        <td style="color:var(--warn); font-weight:bold;">HIGH</td>
        <td><span class="priority p2">P2</span></td>
    </tr>
    <tr>
        <td>BUG-1</td>
        <td>SpO2 overestimated by +3-5 pts if old_mid path used</td>
        <td>Patients near 90% threshold</td>
        <td>Low (main path uses avg_good)</td>
        <td>MEDIUM</td>
        <td><span class="priority p2">P2</span></td>
    </tr>
    <tr>
        <td>BUG-6</td>
        <td>Signal quality degraded during shivering/tremor</td>
        <td>Hypothermia, fever, Parkinson's</td>
        <td>Moderate</td>
        <td>LOW</td>
        <td><span class="priority p3">P3</span></td>
    </tr>
    </tbody>
</table>

<div class="alert-box alert-info" style="margin-top: 20px;">
    <strong>Current Results:</strong> <strong>30 PASS (75.0%) / 5 WARN (12.5%) / 5 FAIL (12.5%)</strong>. <strong>Improvement:</strong> BUG-4 and BUG-5 fully fixed + FIX-2 recovery rejection working &mdash; asystole and PEA alarms now fire and stay ON (scenarios 23, 24). 4 WARNs are cardiac arrest scenarios (1 is SpO2 bias). The 5 FAILs break down as: 4 HR doubling (BUG-3 &mdash; bandpass filter 0.7Hz + FFT floor 45bpm), 1 SpO2 selection bias at severe hypoxia (NEW). <strong>Next priority:</strong> implement VF/VT detection modality (scenarios 21, 22 have zero alarms &mdash; amplitude-threshold approach fundamentally cannot detect these lethal arrhythmias).
</div>
</section>

<footer>
    <p>CardioWatch 287-2B &mdash; Golden Data AI Analysis Report &mdash; Updated 2026-02-12 (v3)</p>
    <p>Corsano Health &mdash; Firmware Validation Suite</p>
    <p style="margin-top: 8px;">
        <a href="golden_data_analysis.html" style="color: var(--primary-light);">Automated Analysis</a> &nbsp;|&nbsp;
        <a href="golden_data_viewer.html" style="color: var(--primary-light);">Interactive Viewer</a>
    </p>
</footer>

</body>
</html>