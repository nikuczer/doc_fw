<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CardioWatch 287-2B - Golden Data AI Analysis Report</title>
<style>
    :root {
        --primary: #1a365d;
        --primary-light: #2b6cb0;
        --success: #276749;
        --success-bg: #c6f6d5;
        --warn: #744210;
        --warn-bg: #fefcbf;
        --fail: #9b2c2c;
        --fail-bg: #fed7d7;
        --info: #2c5282;
        --info-bg: #bee3f8;
        --border: #e2e8f0;
        --bg-alt: #f7fafc;
        --text: #2d3748;
        --text-light: #718096;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        color: var(--text);
        line-height: 1.6;
        background: #fff;
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px 30px;
    }
    header {
        background: linear-gradient(135deg, var(--primary), var(--primary-light));
        color: white;
        padding: 30px 40px;
        border-radius: 8px;
        margin-bottom: 30px;
    }
    header h1 { font-size: 1.8em; margin-bottom: 5px; }
    header p { opacity: 0.9; font-size: 0.95em; }
    .meta-row {
        display: flex;
        gap: 30px;
        margin-top: 15px;
        font-size: 0.85em;
        opacity: 0.85;
    }
    h2 {
        color: var(--primary);
        border-bottom: 2px solid var(--primary);
        padding-bottom: 8px;
        margin: 30px 0 15px;
        font-size: 1.4em;
    }
    h3 { color: var(--primary-light); margin: 20px 0 10px; font-size: 1.15em; }
    h4 { color: var(--text); margin: 15px 0 8px; font-size: 1.05em; }

    /* Summary cards */
    .summary-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 15px;
        margin: 20px 0;
    }
    .card {
        padding: 20px;
        border-radius: 8px;
        text-align: center;
        border: 1px solid var(--border);
    }
    .card .number { font-size: 2.5em; font-weight: bold; }
    .card .label { font-size: 0.85em; color: var(--text-light); margin-top: 5px; }
    .card-pass { background: var(--success-bg); }
    .card-pass .number { color: var(--success); }
    .card-warn { background: var(--warn-bg); }
    .card-warn .number { color: var(--warn); }
    .card-fail { background: var(--fail-bg); }
    .card-fail .number { color: var(--fail); }
    .card-total { background: var(--info-bg); }
    .card-total .number { color: var(--info); }

    /* Tables */
    table {
        width: 100%;
        border-collapse: collapse;
        margin: 15px 0;
        font-size: 0.88em;
    }
    th {
        background: var(--primary);
        color: white;
        padding: 10px 8px;
        text-align: left;
        font-weight: 600;
        font-size: 0.85em;
        white-space: nowrap;
    }
    td {
        padding: 8px;
        border-bottom: 1px solid var(--border);
        vertical-align: top;
    }
    tr:nth-child(even) { background: var(--bg-alt); }
    tr:hover { background: #edf2f7; }

    /* Verdict badges */
    .badge {
        display: inline-block;
        padding: 2px 10px;
        border-radius: 12px;
        font-size: 0.8em;
        font-weight: 600;
        text-transform: uppercase;
    }
    .badge-pass { background: var(--success-bg); color: var(--success); }
    .badge-warn { background: var(--warn-bg); color: var(--warn); }
    .badge-fail { background: var(--fail-bg); color: var(--fail); }
    .badge-ok { background: #e9d8fd; color: #553c9a; }
    .badge-na { background: #e2e8f0; color: #718096; }

    /* Bug cards */
    .bug-card {
        border: 1px solid var(--border);
        border-radius: 8px;
        margin: 15px 0;
        overflow: hidden;
    }
    .bug-header {
        padding: 12px 18px;
        font-weight: 600;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .bug-p1 .bug-header { background: var(--fail-bg); color: var(--fail); border-left: 4px solid var(--fail); }
    .bug-p2 .bug-header { background: var(--warn-bg); color: var(--warn); border-left: 4px solid #d69e2e; }
    .bug-p3 .bug-header { background: var(--info-bg); color: var(--info); border-left: 4px solid var(--info); }
    .bug-body { padding: 15px 18px; }
    .bug-body dt { font-weight: 600; margin-top: 8px; color: var(--primary); }
    .bug-body dd { margin-left: 15px; margin-bottom: 5px; }

    /* Code blocks */
    code {
        background: #edf2f7;
        padding: 1px 5px;
        border-radius: 3px;
        font-family: 'Consolas', 'Monaco', monospace;
        font-size: 0.9em;
    }
    pre {
        background: #1a202c;
        color: #e2e8f0;
        padding: 15px;
        border-radius: 6px;
        overflow-x: auto;
        font-size: 0.85em;
        margin: 10px 0;
        line-height: 1.5;
    }
    pre code { background: none; color: inherit; padding: 0; }

    /* Sections */
    .section { margin: 25px 0; }
    .finding-box {
        background: var(--bg-alt);
        border-left: 4px solid var(--primary-light);
        padding: 12px 18px;
        margin: 10px 0;
        border-radius: 0 6px 6px 0;
    }
    .alert-box {
        padding: 12px 18px;
        border-radius: 6px;
        margin: 10px 0;
    }
    .alert-fail { background: var(--fail-bg); border-left: 4px solid var(--fail); }
    .alert-warn { background: var(--warn-bg); border-left: 4px solid #d69e2e; }
    .alert-info { background: var(--info-bg); border-left: 4px solid var(--info); }

    /* Priority tags */
    .priority {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 0.75em;
        font-weight: 700;
    }
    .p1 { background: var(--fail); color: white; }
    .p2 { background: #d69e2e; color: white; }
    .p3 { background: var(--info); color: white; }

    /* Links bar */
    .nav-links {
        display: flex;
        gap: 20px;
        margin: 15px 0;
        padding: 12px 18px;
        background: var(--bg-alt);
        border-radius: 6px;
    }
    .nav-links a {
        color: var(--primary-light);
        text-decoration: none;
        font-weight: 500;
    }
    .nav-links a:hover { text-decoration: underline; }

    footer {
        margin-top: 40px;
        padding: 20px;
        border-top: 1px solid var(--border);
        text-align: center;
        color: var(--text-light);
        font-size: 0.85em;
    }

    .category-header {
        background: var(--primary);
        color: white;
        padding: 5px 12px;
        border-radius: 4px;
        font-size: 0.8em;
        display: inline-block;
        margin: 2px 0;
    }

    .ratio-highlight {
        background: var(--fail-bg);
        padding: 1px 6px;
        border-radius: 3px;
        font-weight: 600;
        color: var(--fail);
    }

    .toc {
        background: var(--bg-alt);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 20px 25px;
        margin: 20px 0;
    }
    .toc ol { padding-left: 20px; }
    .toc li { margin: 5px 0; }
    .toc a { color: var(--primary-light); text-decoration: none; }
    .toc a:hover { text-decoration: underline; }

    @media print {
        body { max-width: none; padding: 10px; }
        header { break-after: avoid; }
        .bug-card { break-inside: avoid; }
        pre { white-space: pre-wrap; }
    }
</style>
</head>
<body>

<header>
    <h1>Golden Data AI Analysis Report</h1>
    <p>CardioWatch 287-2B Firmware &mdash; Deep Root-Cause Analysis of 40 Clinical Scenarios</p>
    <div class="meta-row">
        <span>Date: 2026-02-11</span>
        <span>MCU: nRF52840</span>
        <span>PPG: MAX86178 (Green/Red/IR)</span>
        <span>ACC: LIS2DW12</span>
        <span>Sampling: 32 Hz</span>
    </div>
</header>

<nav class="nav-links">
    <a href="golden_data_analysis.html">Automated Analysis Report</a>
    <a href="golden_data_viewer.html">Interactive Data Viewer</a>
</nav>

<div class="toc">
    <strong>Table of Contents</strong>
    <ol>
        <li><a href="#executive-summary">Executive Summary</a></li>
        <li><a href="#overview-table">Overview Table &mdash; All 40 Scenarios</a></li>
        <li><a href="#bugs-identified">Bugs Identified (7 Open, 1 Fixed)</a></li>
        <li><a href="#spo2-analysis">SpO2 Detailed Analysis</a></li>
        <li><a href="#hr-analysis">HR Detailed Analysis</a></li>
        <li><a href="#cardiac-arrest-analysis">Cardiac Arrest Detection Analysis</a></li>
        <li><a href="#results-by-category">Results by Category</a></li>
        <li><a href="#recommendations">Recommendations</a></li>
        <li><a href="#impact-matrix">Impact Matrix</a></li>
    </ol>
</div>

<!-- ============================================================ -->
<!-- 1. EXECUTIVE SUMMARY -->
<!-- ============================================================ -->
<section id="executive-summary">
<h2>1. Executive Summary</h2>

<div class="summary-grid">
    <div class="card card-total">
        <div class="number">40</div>
        <div class="label">Total Scenarios</div>
    </div>
    <div class="card card-pass">
        <div class="number">29</div>
        <div class="label">PASS (72.5%)</div>
    </div>
    <div class="card card-warn">
        <div class="number">5</div>
        <div class="label">WARN (12.5%)</div>
    </div>
    <div class="card card-fail">
        <div class="number">6</div>
        <div class="label">FAIL (15.0%)</div>
    </div>
</div>

<div class="alert-box alert-fail">
    <strong>Critical Patient Safety Issue:</strong> Cardiac arrest detection is completely non-functional. None of the 4 cardiac arrest scenarios (21-24) trigger an alarm, due to 3 independent bugs in <code>corsano_cardiac_arrest.c</code>. This is the highest priority finding.
</div>

<div class="alert-box alert-warn">
    <strong>HR Doubling Bug:</strong> Heart rate is consistently doubled for bradycardic patients (HR &lt; 55 bpm) due to dicrotic notch misdetection. Affects 4 scenarios with measured/expected ratios of exactly 2.0. Reported with high confidence (quality=3).
</div>

<h3>Key Findings</h3>
<ul>
    <li><strong>8 bugs identified</strong> (5 previously known, 3 new) &mdash; <strong>7 open, 1 fixed</strong></li>
    <li><strong>P1 (Patient Safety):</strong> 3 bugs &mdash; Cardiac arrest alarm never fires (BUG-4, BUG-5), counter reset by spurious peaks (NEW)</li>
    <li><strong>P2 (Algorithm):</strong> 3 bugs &mdash; HR doubling (BUG-3), SpO2 selection bias (NEW), SpO2 old_mid bias (BUG-1)</li>
    <li><strong>P3 (Simulator/Tooling):</strong> 1 open bug &mdash; ACC classifier (BUG-6). Analysis script wrong expected values: <strong>FIXED</strong> (scenarios 26, 30 now PASS)</li>
    <li><strong>Improvement vs previous run:</strong> 2 scenarios moved from WARN to PASS after the analysis script fix (26_hf_pulsus_alternans, 30_tamponade)</li>
</ul>
</section>

<!-- ============================================================ -->
<!-- 2. OVERVIEW TABLE -->
<!-- ============================================================ -->
<section id="overview-table">
<h2>2. Overview Table &mdash; All 40 Scenarios</h2>

<table>
<thead>
<tr>
    <th>#</th>
    <th>Scenario</th>
    <th>Category</th>
    <th>HR Exp</th>
    <th>HR Meas</th>
    <th>HR &Delta;</th>
    <th>HR V</th>
    <th>SpO2 Exp</th>
    <th>SpO2 Meas</th>
    <th>SpO2 &Delta;</th>
    <th>SpO2 V</th>
    <th>Score</th>
    <th>Root Cause</th>
</tr>
</thead>
<tbody>
<tr><td>01</td><td>normal_rest</td><td><span class="category-header">Rest</span></td><td>70</td><td>70.9</td><td>0.9</td><td><span class="badge badge-pass">PASS</span></td><td>98</td><td>99.0</td><td>1.0</td><td><span class="badge badge-pass">PASS</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>02</td><td>elderly_rest</td><td><span class="category-header">Rest</span></td><td>65</td><td>75.7</td><td>10.7</td><td><span class="badge badge-ok">OK</span></td><td>96</td><td>97.3</td><td>1.3</td><td><span class="badge badge-pass">PASS</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>03</td><td>athlete_rest</td><td><span class="category-header">Rest</span></td><td>52</td><td>50.2</td><td>1.8</td><td><span class="badge badge-pass">PASS</span></td><td>99</td><td>99.0</td><td>0.0</td><td><span class="badge badge-pass">PASS</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>04</td><td>hypoxia_mild</td><td><span class="category-header">Hypoxia</span></td><td>95</td><td>96.8</td><td>1.8</td><td><span class="badge badge-pass">PASS</span></td><td>92</td><td>95.4</td><td>3.4</td><td><span class="badge badge-warn">WARN</span></td><td><span class="badge badge-warn">WARN</span></td><td>BUG-1</td></tr>
<tr><td>05</td><td>hypoxia_moderate</td><td><span class="category-header">Hypoxia</span></td><td>110</td><td>118.2</td><td>8.2</td><td><span class="badge badge-pass">PASS</span></td><td>85</td><td>83.6</td><td>1.4</td><td><span class="badge badge-pass">PASS</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>06</td><td>hypoxia_severe</td><td><span class="category-header">Hypoxia</span></td><td>140</td><td>144.4</td><td>4.4</td><td><span class="badge badge-pass">PASS</span></td><td>72</td><td>86.6</td><td>14.6</td><td><span class="badge badge-fail">FAIL</span></td><td><span class="badge badge-fail">FAIL</span></td><td>NEW: Selection bias</td></tr>
<tr><td>07</td><td>walking</td><td><span class="category-header">Activity</span></td><td>100</td><td>105.2</td><td>5.2</td><td><span class="badge badge-pass">PASS</span></td><td>97</td><td>0</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>08</td><td>running</td><td><span class="category-header">Activity</span></td><td>165</td><td>171.0</td><td>6.0</td><td><span class="badge badge-pass">PASS</span></td><td>96</td><td>0</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>09</td><td>wrist_movement</td><td><span class="category-header">Activity</span></td><td>var</td><td>103.8</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td>var</td><td>99.4</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>10</td><td>af_rapid</td><td><span class="category-header">Arrhythmias</span></td><td>130</td><td>129.5</td><td>0.5</td><td><span class="badge badge-pass">PASS</span></td><td>96</td><td>97.3</td><td>1.3</td><td><span class="badge badge-pass">PASS</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>11</td><td>af_controlled</td><td><span class="category-header">Arrhythmias</span></td><td>75</td><td>72.0</td><td>3.0</td><td><span class="badge badge-pass">PASS</span></td><td>97</td><td>97.3</td><td>0.3</td><td><span class="badge badge-pass">PASS</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>12</td><td>flutter_2_1</td><td><span class="category-header">Arrhythmias</span></td><td>150</td><td>158.4</td><td>8.4</td><td><span class="badge badge-pass">PASS</span></td><td>96</td><td>97.3</td><td>1.3</td><td><span class="badge badge-pass">PASS</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>13</td><td>esv_bigeminy</td><td><span class="category-header">Arrhythmias</span></td><td>80</td><td>81.2</td><td>1.2</td><td><span class="badge badge-pass">PASS</span></td><td>97</td><td>98.2</td><td>1.2</td><td><span class="badge badge-pass">PASS</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>14</td><td>esv_trigeminy</td><td><span class="category-header">Arrhythmias</span></td><td>80</td><td>80.8</td><td>0.8</td><td><span class="badge badge-pass">PASS</span></td><td>97</td><td>98.1</td><td>1.1</td><td><span class="badge badge-pass">PASS</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>15</td><td>psvt_episodes</td><td><span class="category-header">Arrhythmias</span></td><td>var</td><td>71.8</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td>96</td><td>98.3</td><td>2.3</td><td><span class="badge badge-ok">OK</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>16</td><td>vt_monomorphic</td><td><span class="category-header">Arrhythmias</span></td><td>180</td><td>185.6</td><td>5.6</td><td><span class="badge badge-pass">PASS</span></td><td>var</td><td>92.5</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>17</td><td>torsades</td><td><span class="category-header">Arrhythmias</span></td><td>var</td><td>178.7</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td>var</td><td>0</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>18</td><td>bradycardia</td><td><span class="category-header">Bradycardia</span></td><td>42</td><td>84.2</td><td>42.2</td><td><span class="badge badge-fail">FAIL</span></td><td>97</td><td>98.1</td><td>1.1</td><td><span class="badge badge-pass">PASS</span></td><td><span class="badge badge-fail">FAIL</span></td><td>BUG-3 (ratio <span class="ratio-highlight">2.005</span>)</td></tr>
<tr><td>19</td><td>bav2_mobitz1</td><td><span class="category-header">Bradycardia</span></td><td>var</td><td>50.4</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td>97</td><td>98.1</td><td>1.1</td><td><span class="badge badge-pass">PASS</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>20</td><td>bav3_complete</td><td><span class="category-header">Bradycardia</span></td><td>33</td><td>70.8</td><td>37.8</td><td><span class="badge badge-fail">FAIL</span></td><td>96</td><td>97.0</td><td>1.0</td><td><span class="badge badge-pass">PASS</span></td><td><span class="badge badge-fail">FAIL</span></td><td>BUG-3 (ratio <span class="ratio-highlight">2.023</span>)</td></tr>
<tr><td>21</td><td>vf_from_sinus</td><td><span class="category-header">Cardiac Arrest</span></td><td>75&rarr;VF</td><td>80.8</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td>var</td><td>98.1</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td><span class="badge badge-warn">WARN</span></td><td>BUG-4, BUG-5</td></tr>
<tr><td>22</td><td>vt_to_vf</td><td><span class="category-header">Cardiac Arrest</span></td><td>var</td><td>86.9</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td>var</td><td>97.9</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td><span class="badge badge-warn">WARN</span></td><td>BUG-4, BUG-5</td></tr>
<tr><td>23</td><td>asystole</td><td><span class="category-header">Cardiac Arrest</span></td><td>var</td><td>99.7</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td>var</td><td>97.2</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td><span class="badge badge-warn">WARN</span></td><td>BUG-4, BUG-5, NEW</td></tr>
<tr><td>24</td><td>pea</td><td><span class="category-header">Cardiac Arrest</span></td><td>80&rarr;PEA</td><td>81.7</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td>var</td><td>98.1</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td><span class="badge badge-warn">WARN</span></td><td>BUG-4, BUG-5</td></tr>
<tr><td>25</td><td>progressive_deterioration</td><td><span class="category-header">Transitional</span></td><td>var</td><td>101.7</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td>var</td><td>87.7</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>26</td><td>hf_pulsus_alternans</td><td><span class="category-header">Cardiac Path</span></td><td>110</td><td>112.8</td><td>2.8</td><td><span class="badge badge-pass">PASS</span></td><td>96</td><td>98.5</td><td>2.5</td><td><span class="badge badge-ok">OK</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>27</td><td>hf_cheyne_stokes</td><td><span class="category-header">Cardiac Path</span></td><td>85</td><td>93.3</td><td>8.3</td><td><span class="badge badge-pass">PASS</span></td><td>var</td><td>95.6</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>28</td><td>aortic_stenosis</td><td><span class="category-header">Cardiac Path</span></td><td>75</td><td>81.1</td><td>6.1</td><td><span class="badge badge-pass">PASS</span></td><td>97</td><td>98.1</td><td>1.1</td><td><span class="badge badge-pass">PASS</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>29</td><td>aortic_regurgitation</td><td><span class="category-header">Cardiac Path</span></td><td>80</td><td>86.4</td><td>6.4</td><td><span class="badge badge-pass">PASS</span></td><td>97</td><td>98.1</td><td>1.1</td><td><span class="badge badge-pass">PASS</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>30</td><td>tamponade</td><td><span class="category-header">Cardiac Path</span></td><td>115</td><td>118.2</td><td>3.2</td><td><span class="badge badge-pass">PASS</span></td><td>var</td><td>97.3</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>31</td><td>hcm</td><td><span class="category-header">Cardiac Path</span></td><td>70</td><td>75.8</td><td>5.8</td><td><span class="badge badge-pass">PASS</span></td><td>97</td><td>98.1</td><td>1.1</td><td><span class="badge badge-pass">PASS</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>32</td><td>hemorrhagic_shock</td><td><span class="category-header">Extreme</span></td><td>130</td><td>134.3</td><td>4.3</td><td><span class="badge badge-pass">PASS</span></td><td>96</td><td>89.1</td><td>6.9</td><td><span class="badge badge-fail">FAIL</span></td><td><span class="badge badge-fail">FAIL</span></td><td>NEW: Low SNR</td></tr>
<tr><td>33</td><td>hypothermia_32C</td><td><span class="category-header">Extreme</span></td><td>55</td><td>108.2</td><td>53.2</td><td><span class="badge badge-fail">FAIL</span></td><td>94</td><td>0</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td><span class="badge badge-fail">FAIL</span></td><td>BUG-3 + BUG-6</td></tr>
<tr><td>34</td><td>hypothermia_28C</td><td><span class="category-header">Extreme</span></td><td>35</td><td>70.2</td><td>35.2</td><td><span class="badge badge-fail">FAIL</span></td><td>90</td><td>0</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td><span class="badge badge-fail">FAIL</span></td><td>BUG-3</td></tr>
<tr><td>35</td><td>sleep_apnea</td><td><span class="category-header">Extreme</span></td><td>60</td><td>58.0</td><td>2.0</td><td><span class="badge badge-pass">PASS</span></td><td>var</td><td>99.0</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>36</td><td>vasovagal_syncope</td><td><span class="category-header">Extreme</span></td><td>var</td><td>78.4</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td>var</td><td>98.2</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>37</td><td>venous_pooling</td><td><span class="category-header">Extreme</span></td><td>75</td><td>61.9</td><td>13.1</td><td><span class="badge badge-ok">OK</span></td><td>97</td><td>95.4</td><td>1.6</td><td><span class="badge badge-pass">PASS</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>38</td><td>severe_anemia</td><td><span class="category-header">Extreme</span></td><td>110</td><td>112.6</td><td>2.6</td><td><span class="badge badge-pass">PASS</span></td><td>var</td><td>99.0</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>39</td><td>parkinsonian_tremor</td><td><span class="category-header">Extreme</span></td><td>70</td><td>71.1</td><td>1.1</td><td><span class="badge badge-pass">PASS</span></td><td>97</td><td>0</td><td>&mdash;</td><td><span class="badge badge-na">N/A</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
<tr><td>40</td><td>co_poisoning</td><td><span class="category-header">Extreme</span></td><td>110</td><td>112.7</td><td>2.7</td><td><span class="badge badge-pass">PASS</span></td><td>99</td><td>99.0</td><td>0.0</td><td><span class="badge badge-pass">PASS</span></td><td><span class="badge badge-pass">PASS</span></td><td>&mdash;</td></tr>
</tbody>
</table>
<p style="font-size:0.85em; color:var(--text-light);">Note: Scenarios 26 and 30 previously showed false WARNs due to incorrect expected HR values in the analysis script. This has been fixed &mdash; expected values now match metadata (110, 115 bpm respectively).</p>
</section>

<!-- ============================================================ -->
<!-- 3. BUGS IDENTIFIED -->
<!-- ============================================================ -->
<section id="bugs-identified">
<h2>3. Bugs Identified</h2>
<p>8 bugs total: 5 previously known (confirmed still present), 3 newly discovered. <strong>7 open, 1 fixed.</strong></p>

<!-- BUG-4 -->
<div class="bug-card bug-p1">
    <div class="bug-header">
        <span>BUG-4: Cardiac Arrest Alarm Never Fires (Invalid-Pair Branch)</span>
        <span class="priority p1">P1 &mdash; PATIENT SAFETY</span>
    </div>
    <div class="bug-body">
        <dl>
            <dt>Symptom</dt>
            <dd>Zero "Cardiac Alarm ON" messages in all 4 cardiac arrest scenarios (21-24). Cardiac arrest is never detected.</dd>
            <dt>Affected Scenarios</dt>
            <dd>21_vf_from_sinus, 22_vt_to_vf, 23_asystole, 24_pea</dd>
            <dt>Root Cause</dt>
            <dd>In <code>corsano_cardiac_arrest.c:346-352</code>, the <code>else</code> branch (invalid pair: peak-trough time &gt; 1.0s) accumulates <code>below_threshold_duration</code> and logs "Cardiac below thresh", but <strong>never checks</strong> if the duration exceeds <code>min_duration</code> (10s) to fire the alarm. During cardiac arrest, peaks have chaotic timing (peak-trough &gt; 1.0s), so the code enters this branch exclusively. The alarm check at line 264 is unreachable.</dd>
            <dt>Evidence</dt>
            <dd>
<pre><code>// corsano_cardiac_arrest.c:346-352 -- alarm check MISSING
} else {
    below_threshold_duration += time_diff;
    if (below_threshold_duration > 5.0)
        LOG_TO_FLASH("Cardiac below thresh %.1f %.1f.",
            below_threshold_duration, time_diff);
    // NO alarm check here -- compare with line 264 in valid-pair branch
}</code></pre>
            </dd>
            <dt>Fix</dt>
            <dd>Add alarm condition check after <code>below_threshold_duration += time_diff;</code> in the invalid-pair branch, mirroring the logic at lines 264-268.</dd>
        </dl>
    </div>
</div>

<!-- BUG-5 -->
<div class="bug-card bug-p1">
    <div class="bug-header">
        <span>BUG-5: Shadowed Variable Prevents Gap-Based Alarm</span>
        <span class="priority p1">P1 &mdash; PATIENT SAFETY</span>
    </div>
    <div class="bug-body">
        <dl>
            <dt>Symptom</dt>
            <dd>The gap-detection alarm ("Cardiac Alarm ON!") can never fire. Even when no valid peaks are seen for &gt;10 seconds, the alarm is not triggered.</dd>
            <dt>Root Cause</dt>
            <dd>Local variable <code>float last_peak_above_threshold = 0.0;</code> at <code>corsano_cardiac_arrest.c:233</code> shadows the global at line 143. Every function call starts with the local at 0.0, so the condition <code>if (last_peak_above_threshold != 0)</code> at line 243 is <strong>always false</strong>. The gap duration is never computed.</dd>
            <dt>Evidence</dt>
            <dd>
<pre><code>// Line 143 (global):
float last_peak_above_threshold = 0;

// Line 233 (local shadow -- BUG):
void corsano_cardiac_arrest_send_peak(...) {
    float last_peak_above_threshold = 0.0;  // SHADOWS GLOBAL!
    ...
    if (last_peak_above_threshold != 0) {   // ALWAYS FALSE
        float gap_duration = (peak_time - last_peak_above_threshold);
        if (gap_duration > min_duration && !alarm_on) {
            LOG_TO_FLASH("Cardiac Alarm ON!");  // NEVER REACHED
        }
    }
}</code></pre>
            </dd>
            <dt>Fix</dt>
            <dd>Remove the local declaration at line 233. Use the global variable directly.</dd>
        </dl>
    </div>
</div>

<!-- NEW: Counter Reset -->
<div class="bug-card bug-p1">
    <div class="bug-header">
        <span>NEW: Below-Threshold Counter Reset by Spurious Peaks</span>
        <span class="priority p1">P1 &mdash; PATIENT SAFETY</span>
    </div>
    <div class="bug-body">
        <dl>
            <dt>Symptom</dt>
            <dd>In scenario 23 (asystole), <code>below_threshold_duration</code> reaches 31.8 seconds (well past the 10s alarm threshold) but then resets to ~6 seconds. The cycle repeats without ever triggering an alarm.</dd>
            <dt>Root Cause</dt>
            <dd>At <code>corsano_cardiac_arrest.c:340-344</code>, a <strong>single</strong> spurious above-threshold peak resets <code>below_threshold_duration = 0</code>. During cardiac arrest, noise occasionally produces peaks that satisfy <code>amplitude_difference >= threshold</code>, resetting the entire counter.</dd>
            <dt>Evidence</dt>
            <dd>Scenario 23 (asystole) log shows 3 reset cycles across 43 "Cardiac below thresh" messages:
<pre><code>// Cluster 1: builds to 27.8s then resets
Cardiac below thresh 7.8 7.8  // starts
Cardiac below thresh 14.2 2.0  // accumulating
Cardiac below thresh 23.8 2.0  // still going
Cardiac below thresh 27.8 2.0  // MAX 27.8s -- then resets!

// Cluster 3: builds to 31.8s then resets
Cardiac below thresh 25.6 1.8  // accumulating
Cardiac below thresh 29.6 2.0  // past 10s alarm threshold!
Cardiac below thresh 31.8 2.0  // MAX 31.8s -- then resets!
Cardiac below thresh 6.1 6.1   // RESET by spurious peak</code></pre>
            </dd>
            <dt>Fix</dt>
            <dd>Require N consecutive above-threshold peaks (e.g., 4) before resetting the counter, consistent with the alarm-off logic design.</dd>
        </dl>
    </div>
</div>

<!-- BUG-3 -->
<div class="bug-card bug-p2">
    <div class="bug-header">
        <span>BUG-3: HR Doubling by Dicrotic Notch (HR &lt; 55 bpm)</span>
        <span class="priority p2">P2 &mdash; ALGORITHM</span>
    </div>
    <div class="bug-body">
        <dl>
            <dt>Symptom</dt>
            <dd>Heart rate is consistently reported at exactly 2x the true rate for bradycardic patients. Measured/expected ratios: 2.005, 2.023, 1.967, 2.006. Algorithm reports with high confidence (quality=3).</dd>
            <dt>Affected Scenarios</dt>
            <dd>18_bradycardia (42&rarr;84 bpm), 20_bav3_complete (33&rarr;71 bpm), 33_hypothermia_32C (55&rarr;108 bpm), 34_hypothermia_28C (35&rarr;70 bpm)</dd>
            <dt>Root Cause</dt>
            <dd>At HR &lt; 55 bpm (IBI &gt; 1090ms), the dicrotic notch in the PPG waveform has sufficient temporal separation from the systolic peak to be detected as a separate cardiac beat by the peak detector at <code>mmt_vital_algorithms.c:929</code>. Even with attenuated notch depth (0.04-0.06), the long IBI gives the notch maximum prominence.</dd>
            <dt>Evidence</dt>
            <dd>
                <table>
                    <tr><th>Scenario</th><th>Expected HR</th><th>Measured HR</th><th>Ratio</th><th>HR Std</th><th>Quality</th></tr>
                    <tr><td>18_bradycardia</td><td>42</td><td>84.2</td><td><span class="ratio-highlight">2.005</span></td><td>0.7</td><td>3 (high)</td></tr>
                    <tr><td>20_bav3_complete</td><td>35</td><td>70.8</td><td><span class="ratio-highlight">2.023</span></td><td>0.5</td><td>3 (high)</td></tr>
                    <tr><td>33_hypothermia_32C</td><td>55</td><td>108.2</td><td><span class="ratio-highlight">1.967</span></td><td>2.5</td><td>1-2 (low*)</td></tr>
                    <tr><td>34_hypothermia_28C</td><td>35</td><td>70.2</td><td><span class="ratio-highlight">2.006</span></td><td>0.5</td><td>3 (high)</td></tr>
                </table>
                <p style="font-size:0.85em;">* Scenario 33 has additional shivering noise (BUG-6 interaction), reducing quality and adding HR variance.</p>
            </dd>
            <dt>Fix</dt>
            <dd>Add dicrotic notch rejection: suppress secondary peaks within 300-500ms of a primary systolic peak when the secondary amplitude is significantly smaller.</dd>
        </dl>
    </div>
</div>

<!-- NEW: Selection Bias -->
<div class="bug-card bug-p2">
    <div class="bug-header">
        <span>NEW: SpO2 Selection Bias at Extreme R-Ratios</span>
        <span class="priority p2">P2 &mdash; ALGORITHM</span>
    </div>
    <div class="bug-body">
        <dl>
            <dt>Symptom</dt>
            <dd>Scenario 06 (severe hypoxia, target SpO2=72%): measured 86.6% (+14.6 delta). Per-beat SpO2 values scatter wildly from 50 to 97 in the same window.</dd>
            <dt>Root Cause</dt>
            <dd>At R ~1.5 (SpO2 ~72%), the quality filter at <code>mmt_vital_algorithms.c:4574</code> (<code>if (R > 2) good = false</code>) and the <code>spo2_std > 10</code> filter systematically reject the most hypoxic beats (highest R values) while keeping beats where noise accidentally lowered R. This creates a <strong>positive selection bias</strong> &mdash; the average is biased upward. Additionally, 40% of measurement windows produce <code>avg_good = 0</code> (no qualifying beats), and the remaining windows are biased.</dd>
            <dt>Evidence</dt>
            <dd>TTT1 log: R = 1.518 (expected 1.401). Per-beat scatter: <code>Spo2s__1,92.76,87.03,64.37,70.92,92.97,70.90,67.76,61.34</code> &mdash; same window, values range from 61 to 93.</dd>
            <dt>Fix</dt>
            <dd>Implement adaptive R-ratio quality thresholds based on the running R estimate. For R &gt; 1.2 (SpO2 &lt; 78%), widen the acceptance window or use median instead of mean.</dd>
        </dl>
    </div>
</div>

<!-- BUG-1 -->
<div class="bug-card bug-p2">
    <div class="bug-header">
        <span>BUG-1: SpO2 old_mid Formula +5 Offset Bias</span>
        <span class="priority p2">P2 &mdash; ALGORITHM</span>
    </div>
    <div class="bug-body">
        <dl>
            <dt>Symptom</dt>
            <dd>The <code>old_mid</code> SpO2 values are consistently 3-5 points higher than <code>avg_good</code> values.</dd>
            <dt>Root Cause</dt>
            <dd>The formula at <code>mmt_vital_algorithms.c:5325</code> contains a hardcoded <code>+5</code> offset:
<pre><code>float y = 1.595 * x * x - 32.67 * x + 112.69 + 5;</code></pre>
                This produces SpO2 = 94.8 instead of 90.5 for R = 0.726 (scenario 04).</dd>
            <dt>Status</dt>
            <dd>The current firmware code path uses <code>spo2_avg_good</code> (tuned curve) for the final <code>SPO2_F</code> output. However, if the analysis pipeline or any fallback path uses <code>old_mid</code>, the bias appears.</dd>
            <dt>Fix</dt>
            <dd>Remove the <code>+5</code> constant from the old_mid formula, or ensure the analysis pipeline exclusively reads <code>SPO2_F</code> values.</dd>
        </dl>
    </div>
</div>

<!-- BUG-6 -->
<div class="bug-card bug-p3">
    <div class="bug-header">
        <span>BUG-6: ACC Classifier &mdash; Shivering Misclassified as OTHER</span>
        <span class="priority p3">P3 &mdash; SIMULATOR</span>
    </div>
    <div class="bug-body">
        <dl>
            <dt>Symptom</dt>
            <dd>Scenario 33 (hypothermia 32&deg;C with shivering): activity classified as OTHER (type=1) instead of REST (type=7). Causes 100% SpO2 rejection and 0% HR quality.</dd>
            <dt>Root Cause</dt>
            <dd>In <code>sim_stubs.c:485-490</code>, ACC variance in [5000, 50000) is classified as OTHER. Shivering at 0.15g produces variance ~17k, falling in this range.</dd>
            <dt>Impact</dt>
            <dd>Amplifies BUG-3: the OTHER classification prevents quality-enhancement filters, making the HR doubling noisier (std=2.5 vs &lt;1.0 for pure BUG-3 scenarios).</dd>
        </dl>
    </div>
</div>

<!-- FIXED: Analysis Script Wrong Values -->
<div class="bug-card bug-p3" style="opacity: 0.7;">
    <div class="bug-header" style="background: var(--success-bg); color: var(--success); border-left: 4px solid var(--success);">
        <span>FIXED: Analysis Script Wrong Expected HR Values</span>
        <span class="badge badge-pass">FIXED</span>
    </div>
    <div class="bug-body">
        <dl>
            <dt>Symptom (resolved)</dt>
            <dd>Scenarios 26 and 30 were flagged as WARN despite firmware measuring correctly.</dd>
            <dt>Root Cause</dt>
            <dd><code>analyze_golden_results.py</code> was using expected HR = 95 (scenario 26) and 100 (scenario 30), but metadata specifies 110 and 115 respectively.</dd>
            <dt>Resolution</dt>
            <dd>Expected values updated to match metadata. Both scenarios now PASS correctly (delta 2.8 and 3.2 bpm).</dd>
        </dl>
    </div>
</div>

</section>

<!-- ============================================================ -->
<!-- 4. SpO2 DETAILED ANALYSIS -->
<!-- ============================================================ -->
<section id="spo2-analysis">
<h2>4. SpO2 Detailed Analysis</h2>

<h3>R-Ratio Verification</h3>
<p>SpO2 is computed from the ratio of ratios: <code>R = (AC_red/DC_red) / (AC_ir/DC_ir)</code>, then <code>SpO2 = 108.49 - 30.09*R - 0.031*R&sup2;</code>.</p>

<table>
    <thead>
    <tr><th>Scenario</th><th>Target SpO2</th><th>Generator R</th><th>Observed R (TTT1)</th><th>Default Curve SpO2</th><th>Tuned SpO2</th><th>Reported SpO2</th><th>Delta</th></tr>
    </thead>
    <tbody>
    <tr><td>01_normal_rest</td><td>98</td><td>0.493</td><td>~0.49</td><td>98.0</td><td>97.4</td><td>99.0</td><td>+1.0</td></tr>
    <tr><td>04_hypoxia_mild</td><td>92</td><td>0.703</td><td>0.726</td><td>91.3</td><td>90.5</td><td>95.4</td><td>+3.4</td></tr>
    <tr><td>05_hypoxia_moderate</td><td>85</td><td>0.947</td><td>~0.95</td><td>84.9</td><td>83.8</td><td>83.6</td><td>-1.4</td></tr>
    <tr style="background: var(--fail-bg);">
        <td>06_hypoxia_severe</td><td>72</td><td>1.401</td><td>1.518</td><td>68.7</td><td>66.9</td><td>86.6</td><td style="color:var(--fail); font-weight:bold;">+14.6</td>
    </tr>
    <tr style="background: var(--fail-bg);">
        <td>32_hemorrhagic_shock</td><td>96</td><td>0.563</td><td>0.952</td><td>84.9</td><td>83.7</td><td>89.1</td><td style="color:var(--fail); font-weight:bold;">-6.9</td>
    </tr>
    </tbody>
</table>

<h3>Key SpO2 Findings</h3>

<div class="finding-box">
    <strong>06_hypoxia_severe:</strong> The quality filter (R &gt; 2 cutoff + spo2_std &gt; 10) creates selection bias at extreme R values. Per-beat SpO2 scatters wildly within a single window:
<pre><code>Spo2s__1,92.76,87.03,64.37,70.92,92.97,70.90,67.76,61.34,75.47
Spo2s__1,71.08,64.57,85.45,78.18,50.84,86.30,82.37,65.54,67.07</code></pre>
    232 per-beat windows processed; SPO2_F quality&gt;0 in only 60.4% of intervals (145/240). Raw values range 56-81, but only 10.3% of 1-minute aggregations pass quality. The surviving minutes are biased upward by selection (+14.6 delta).
</div>

<div class="finding-box">
    <strong>32_hemorrhagic_shock:</strong> Very low DC levels (DC_R=21, DC_IR=69, DC_G=45 &mdash; ~0.4x normal). TTT1 confirms poor perfusion:
<pre><code>TTT1 amp_R 104, amp_iR 359, DC_R 21, DC_IR 69, PI_R 4.778, PI_IR 5.199
TTT1 amp_R  89, amp_iR 298, DC_R 21, DC_IR 69, PI_R 4.063, PI_IR 4.294</code></pre>
    SPO2_F yield only 42.5% (102/240). Reported SpO2 range 67-97 (wide scatter), averaging 89.1 vs expected 96. PI_R and PI_IR are close, making R-ratio noise-sensitive.
</div>

<div class="finding-box">
    <strong>04_hypoxia_mild:</strong> TTT1 confirms mild desaturation (PI_IR ~5.9-6.1 &gt; PI_R ~4.2-4.3). The <code>old_mid</code> formula at <code>mmt_vital_algorithms.c:5325</code> contains <code>+5</code> bias:
<pre><code>SPO2s1  avg_good(91.1,4)  old_mid (94,4)
SPO2s2  avg_good(91.1,4)  old_mid (94,4)</code></pre>
    The <code>avg_good</code> path reports 91.1% (close to target 92%), but old_mid gives 94-96%. Per-beat values cluster tightly at 90-93 (good consistency).
</div>

<h3>SpO2 Accuracy by Category</h3>
<table>
    <thead><tr><th>Category</th><th>Scenarios</th><th>Mean Abs Delta</th><th>Pass Rate</th></tr></thead>
    <tbody>
    <tr><td>Normal (SpO2 &ge; 96%)</td><td>23</td><td>1.2</td><td>100%</td></tr>
    <tr><td>Mild Hypoxia (90-95%)</td><td>3</td><td>2.8</td><td>67%</td></tr>
    <tr><td>Severe Hypoxia (&lt; 90%)</td><td>2</td><td>10.8</td><td>0%</td></tr>
    </tbody>
</table>
</section>

<!-- ============================================================ -->
<!-- 5. HR DETAILED ANALYSIS -->
<!-- ============================================================ -->
<section id="hr-analysis">
<h2>5. HR Detailed Analysis</h2>

<h3>HR Doubling Evidence</h3>
<p>Four scenarios show the classic dicrotic notch doubling signature: measured/expected ratio within [1.95, 2.05] with very low standard deviation.</p>

<table>
    <thead><tr><th>Scenario</th><th>Expected HR</th><th>Measured HR</th><th>Ratio</th><th>Std Dev</th><th>Quality</th><th>Notch Depth</th></tr></thead>
    <tbody>
    <tr style="background: var(--fail-bg);">
        <td>18_bradycardia</td><td>42</td><td>84.2</td><td><span class="ratio-highlight">2.005</span></td><td>0.7</td><td>3</td><td>0.06</td>
    </tr>
    <tr style="background: var(--fail-bg);">
        <td>20_bav3_complete</td><td>35</td><td>70.8</td><td><span class="ratio-highlight">2.023</span></td><td>0.5</td><td>3</td><td>0.04</td>
    </tr>
    <tr style="background: var(--fail-bg);">
        <td>33_hypothermia_32C</td><td>55</td><td>108.2</td><td><span class="ratio-highlight">1.967</span></td><td>2.5</td><td>1-2</td><td>0.05</td>
    </tr>
    <tr style="background: var(--fail-bg);">
        <td>34_hypothermia_28C</td><td>35</td><td>70.2</td><td><span class="ratio-highlight">2.006</span></td><td>0.5</td><td>3</td><td>0.05</td>
    </tr>
    </tbody>
</table>

<div class="alert-box alert-fail">
    <strong>Critical observation:</strong> The algorithm reports doubled HR with quality=3 (highest confidence). This means downstream consumers (clinical alerts, activity tracking) will trust the incorrect value. A patient with 35 bpm bradycardia would appear to have a normal 70 bpm heart rate.
</div>

<h3>HR Accuracy by Category</h3>
<table>
    <thead><tr><th>Category</th><th>Scenarios</th><th>Mean Abs Delta</th><th>Pass Rate</th><th>Notes</th></tr></thead>
    <tbody>
    <tr><td>Rest (60-100 bpm)</td><td>3</td><td>4.5</td><td>100%</td><td>Excellent accuracy</td></tr>
    <tr><td>Tachycardia (&gt;100 bpm)</td><td>6</td><td>5.5</td><td>100%</td><td>Good accuracy</td></tr>
    <tr style="background: var(--fail-bg);"><td>Bradycardia (&lt;55 bpm)</td><td>4</td><td>39.4</td><td>0%</td><td>All doubled (BUG-3)</td></tr>
    <tr><td>Arrhythmias</td><td>8</td><td>3.3</td><td>100%</td><td>Excellent for AF, flutter, ESV</td></tr>
    <tr><td>Activity</td><td>3</td><td>5.6</td><td>100%</td><td>Good during motion</td></tr>
    </tbody>
</table>

<h3>Previously False WARNs (Now Fixed)</h3>
<div class="finding-box" style="border-left-color: var(--success);">
    <strong>Scenarios 26 (pulsus alternans) and 30 (tamponade):</strong> Previously flagged as WARN due to incorrect expected HR values in the analysis script (95 and 100 bpm instead of 110 and 115 bpm). <strong>Now fixed</strong> &mdash; both scenarios PASS with deltas of 2.8 and 3.2 bpm respectively.
</div>
</section>

<!-- ============================================================ -->
<!-- 6. CARDIAC ARREST ANALYSIS -->
<!-- ============================================================ -->
<section id="cardiac-arrest-analysis">
<h2>6. Cardiac Arrest Detection Analysis</h2>

<div class="alert-box alert-fail">
    <strong>CRITICAL SAFETY FINDING:</strong> The cardiac arrest detection system is non-functional. None of the 4 arrest scenarios (VF, VT&rarr;VF, asystole, PEA) trigger a cardiac alarm. Three independent bugs prevent alarm activation.
</div>

<h3>Per-Scenario Timeline</h3>
<table>
    <thead>
    <tr><th>Scenario</th><th>Arrest Type</th><th>"Below Thresh" Count</th><th>Max Duration Reached</th><th>Alarm Fired?</th><th>HR During Arrest</th><th>SpO2 During Arrest</th></tr>
    </thead>
    <tbody>
    <tr>
        <td>21_vf_from_sinus</td><td>VF</td><td>1</td><td>8.2s</td><td style="color:var(--fail); font-weight:bold;">NO</td><td>76-151 bpm</td><td>98%</td>
    </tr>
    <tr>
        <td>22_vt_to_vf</td><td>VT&rarr;VF</td><td style="color:var(--fail); font-weight:bold;">0</td><td>N/A</td><td style="color:var(--fail); font-weight:bold;">NO</td><td>81-177 bpm</td><td>98%</td>
    </tr>
    <tr>
        <td>23_asystole</td><td>Asystole</td><td>43</td><td>31.8s</td><td style="color:var(--fail); font-weight:bold;">NO</td><td>72-119 bpm</td><td>97%</td>
    </tr>
    <tr>
        <td>24_pea</td><td>PEA</td><td>1</td><td>8.2s</td><td style="color:var(--fail); font-weight:bold;">NO</td><td>80-103 bpm (93% quality)</td><td>98%</td>
    </tr>
    </tbody>
</table>

<h3>Bug Interaction Diagram</h3>
<div class="finding-box">
    Three independent bugs create a <strong>triple-redundant failure</strong> in cardiac arrest detection:
    <ol>
        <li><strong>BUG-4</strong>: Invalid-pair branch (entered during VF/asystole) has no alarm check &rarr; alarm cannot fire from this path</li>
        <li><strong>BUG-5</strong>: Shadowed variable makes gap-detection alarm unreachable &rarr; backup detection disabled</li>
        <li><strong>NEW bug</strong>: Single spurious peak resets below_threshold_duration counter &rarr; even if alarm check existed, counter would be periodically reset</li>
    </ol>
</div>

<h3>Additional Concerns</h3>
<ul>
    <li><strong>False HR during arrest:</strong> All 4 scenarios report HR 72-177 bpm during arrest phases. The PSP algorithm latches onto noise peaks or uses historical values.</li>
    <li><strong>False SpO2 during arrest:</strong> All scenarios report SpO2 95-100% during arrest &mdash; physiologically impossible.</li>
    <li><strong>LED auto-gain masks signal loss:</strong> When green amplitude drops from ~800 to ~35, LED power increases from 1% to 60%, making the signal appear "present" to the algorithm despite no actual pulse.</li>
    <li><strong>Scenario 24 (PEA) is worst case:</strong> HR reported at 80-103 bpm with 93.1% quality during pulseless rhythm. A clinician relying on the watch would see normal vitals during cardiac arrest.</li>
</ul>
</section>

<!-- ============================================================ -->
<!-- 7. RESULTS BY CATEGORY -->
<!-- ============================================================ -->
<section id="results-by-category">
<h2>7. Results by Category</h2>

<h3>Rest (Scenarios 01-03)</h3>
<div class="finding-box">
    <strong>3/3 PASS.</strong> HR accuracy excellent (&Delta; 0.9-10.7 bpm). SpO2 within &plusmn;1.3 points. Wearing detection works correctly (minute 1). Activity correctly classified as REST. No issues.
</div>

<h3>Hypoxia (Scenarios 04-06)</h3>
<div class="finding-box">
    <strong>1 PASS, 1 WARN, 1 FAIL.</strong> Moderate hypoxia (SpO2=85%) works well. Mild hypoxia shows +3.4 bias (BUG-1 old_mid). Severe hypoxia (SpO2=72%) has critical +14.6 bias from selection filter (NEW bug). <strong>Conclusion: SpO2 accuracy degrades significantly below 80%.</strong>
</div>

<h3>Activity (Scenarios 07-09)</h3>
<div class="finding-box">
    <strong>3/3 PASS.</strong> Walking and running HR within tolerance. SpO2 correctly suppressed during motion (movement rejection active). Step counting operational. Activity classification correct (WALK/RUN).
</div>

<h3>Arrhythmias (Scenarios 10-17)</h3>
<div class="finding-box">
    <strong>8/8 PASS.</strong> Excellent performance across AF (rapid and controlled), flutter, ESV (bigeminy/trigeminy), PSVT, VT monomorphic, and torsades. HR accuracy within 0.5-8.4 bpm for all arrhythmia types. This is the strongest category.
</div>

<h3>Bradycardia (Scenarios 18-20)</h3>
<div class="finding-box">
    <strong>1 PASS, 2 FAIL.</strong> Scenario 19 (Mobitz I, variable rate) passes. Scenarios 18 (42 bpm) and 20 (33 bpm) show exact HR doubling (BUG-3). <strong>Conclusion: All fixed-rate bradycardia &lt; 55 bpm fails due to dicrotic notch.</strong>
</div>

<h3>Cardiac Arrest (Scenarios 21-24)</h3>
<div class="finding-box">
    <strong>0/4 adequate detection.</strong> All 4 scenarios WARN. No alarm triggered in any scenario. HR and SpO2 continue reporting normal values during arrest. This is the most critical failure category. See <a href="#cardiac-arrest-analysis">Section 6</a> for detailed analysis.
</div>

<h3>Cardiac Pathologies (Scenarios 25-31)</h3>
<div class="finding-box">
    <strong>7/7 PASS.</strong> Progressive deterioration, Cheyne-Stokes, aortic stenosis/regurgitation, HCM, pulsus alternans, and tamponade all pass. Previous false WARNs on scenarios 26 and 30 have been resolved by fixing the analysis script expected HR values. This is the strongest category alongside arrhythmias.
</div>

<h3>Extreme Conditions (Scenarios 32-40)</h3>
<div class="finding-box">
    <strong>5 PASS, 3 FAIL.</strong> Hemorrhagic shock SpO2 fails (low SNR). Both hypothermia scenarios fail (HR doubling + shivering). Sleep apnea, vasovagal syncope, venous pooling, severe anemia, Parkinson tremor, and CO poisoning all pass. <strong>Conclusion: Extreme low-perfusion states are problematic.</strong>
</div>
</section>

<!-- ============================================================ -->
<!-- 8. RECOMMENDATIONS -->
<!-- ============================================================ -->
<section id="recommendations">
<h2>8. Recommendations</h2>

<h3><span class="priority p1">P1</span> Patient Safety &mdash; Immediate Action Required</h3>
<table>
    <thead><tr><th>#</th><th>Action</th><th>File</th><th>Impact</th></tr></thead>
    <tbody>
    <tr>
        <td>1</td>
        <td>Add alarm condition check in invalid-pair branch of cardiac arrest detection</td>
        <td><code>corsano_cardiac_arrest.c:346-352</code></td>
        <td>Enables alarm during VF/asystole (BUG-4)</td>
    </tr>
    <tr>
        <td>2</td>
        <td>Remove local <code>last_peak_above_threshold</code> variable shadow</td>
        <td><code>corsano_cardiac_arrest.c:233</code></td>
        <td>Enables gap-based alarm detection (BUG-5)</td>
    </tr>
    <tr>
        <td>3</td>
        <td>Require N consecutive above-threshold peaks before resetting below_threshold_duration</td>
        <td><code>corsano_cardiac_arrest.c:340-344</code></td>
        <td>Prevents spurious counter reset during arrest</td>
    </tr>
    </tbody>
</table>

<h3><span class="priority p2">P2</span> Algorithm Improvements</h3>
<table>
    <thead><tr><th>#</th><th>Action</th><th>File</th><th>Impact</th></tr></thead>
    <tbody>
    <tr>
        <td>4</td>
        <td>Add dicrotic notch rejection for peaks within 300-500ms of systolic peak when amplitude is significantly smaller</td>
        <td><code>mmt_vital_algorithms.c:929</code></td>
        <td>Fixes HR doubling for HR &lt; 55 bpm (BUG-3)</td>
    </tr>
    <tr>
        <td>5</td>
        <td>Implement adaptive R-ratio quality thresholds for low SpO2 regimes (R &gt; 1.2)</td>
        <td><code>mmt_vital_algorithms.c:4574</code></td>
        <td>Fixes SpO2 selection bias at severe hypoxia</td>
    </tr>
    <tr>
        <td>6</td>
        <td>Remove <code>+5</code> constant from old_mid SpO2 formula</td>
        <td><code>mmt_vital_algorithms.c:5325</code></td>
        <td>Eliminates SpO2 upward bias in fallback path (BUG-1)</td>
    </tr>
    </tbody>
</table>

<h3><span class="priority p3">P3</span> Simulator / Tooling</h3>
<table>
    <thead><tr><th>#</th><th>Action</th><th>File</th><th>Impact</th></tr></thead>
    <tbody>
    <tr style="opacity: 0.6; text-decoration: line-through;">
        <td>7</td>
        <td>Update expected HR values for scenarios 26 (95&rarr;110) and 30 (100&rarr;115) &mdash; <strong style="text-decoration: none; color: var(--success);">DONE</strong></td>
        <td><code>analyze_golden_results.py</code></td>
        <td>Eliminated 2 false WARNs</td>
    </tr>
    <tr>
        <td>8</td>
        <td>Scale noise_std proportionally with DC levels in hemorrhagic shock scenario</td>
        <td><code>generate.py</code></td>
        <td>Makes scenario 32 SNR more realistic</td>
    </tr>
    <tr>
        <td>9</td>
        <td>Consider adding adaptive ACC classifier thresholds for shivering vs walking</td>
        <td><code>sim_stubs.c:485-490</code></td>
        <td>Improves hypothermia scenario accuracy (BUG-6)</td>
    </tr>
    </tbody>
</table>
</section>

<!-- ============================================================ -->
<!-- 9. IMPACT MATRIX -->
<!-- ============================================================ -->
<section id="impact-matrix">
<h2>9. Impact Matrix</h2>

<table>
    <thead>
    <tr>
        <th>Bug ID</th>
        <th>Clinical Impact</th>
        <th>Patient Population</th>
        <th>Frequency</th>
        <th>Severity</th>
        <th>Priority</th>
    </tr>
    </thead>
    <tbody>
    <tr style="background: var(--fail-bg);">
        <td>BUG-4 + BUG-5 + NEW</td>
        <td>Cardiac arrest undetected &mdash; patient may die without alarm</td>
        <td>All patients experiencing VF, asystole, PEA</td>
        <td>100% of arrest events</td>
        <td style="color:var(--fail); font-weight:bold;">CRITICAL</td>
        <td><span class="priority p1">P1</span></td>
    </tr>
    <tr style="background: var(--fail-bg);">
        <td>BUG-3</td>
        <td>Bradycardia masked as normal HR &mdash; missed diagnosis, wrong treatment decisions</td>
        <td>Elderly, athletes, AV block, hypothermia (HR &lt; 55 bpm)</td>
        <td>100% at HR &lt; 55</td>
        <td style="color:var(--fail); font-weight:bold;">HIGH</td>
        <td><span class="priority p2">P2</span></td>
    </tr>
    <tr>
        <td>NEW (selection bias)</td>
        <td>Severe hypoxia under-reported &mdash; false reassurance at SpO2 &lt; 80%</td>
        <td>COPD exacerbation, respiratory failure, altitude sickness</td>
        <td>High at SpO2 &lt; 80%</td>
        <td style="color:var(--warn); font-weight:bold;">HIGH</td>
        <td><span class="priority p2">P2</span></td>
    </tr>
    <tr>
        <td>BUG-1</td>
        <td>SpO2 overestimated by +3-5 pts if old_mid path used</td>
        <td>Patients near 90% threshold</td>
        <td>Low (main path uses avg_good)</td>
        <td>MEDIUM</td>
        <td><span class="priority p2">P2</span></td>
    </tr>
    <tr>
        <td>BUG-6</td>
        <td>Signal quality degraded during shivering/tremor</td>
        <td>Hypothermia, fever, Parkinson's</td>
        <td>Moderate</td>
        <td>LOW</td>
        <td><span class="priority p3">P3</span></td>
    </tr>
    </tbody>
</table>

<div class="alert-box alert-info" style="margin-top: 20px;">
    <strong>Current Results:</strong> <strong>29 PASS (72.5%) / 5 WARN (12.5%) / 6 FAIL (15.0%)</strong>. The tooling bug (wrong expected HR for scenarios 26, 30) has been fixed. All 5 remaining WARNs are cardiac arrest scenarios requiring P1 firmware fixes. The 6 FAILs break down as: 4 HR doubling (BUG-3), 1 SpO2 selection bias (NEW), 1 low-SNR SpO2 (hemorrhagic shock).
</div>
</section>

<footer>
    <p>CardioWatch 287-2B &mdash; Golden Data AI Analysis Report &mdash; Updated 2026-02-11</p>
    <p>Corsano Health &mdash; Firmware Validation Suite</p>
    <p style="margin-top: 8px;">
        <a href="golden_data_analysis.html" style="color: var(--primary-light);">Automated Analysis</a> &nbsp;|&nbsp;
        <a href="golden_data_viewer.html" style="color: var(--primary-light);">Interactive Viewer</a>
    </p>
</footer>

</body>
</html>